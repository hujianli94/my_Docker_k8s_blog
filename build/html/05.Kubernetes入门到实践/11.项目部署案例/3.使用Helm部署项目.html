<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>使用Helm部署项目 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="12.Helm学习指南" href="../12.Helm%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/index.html" />
    <link rel="prev" title="有状态项目的部署案例" href="2.%E6%9C%89%E7%8A%B6%E6%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> 小健_Docker_K8s_Blog
            <img src="../../_static/docker-k8s.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../01.Docker%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%983%E7%89%88/index.html">01.Docker技术入门与实战3版</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02.Kubernetes%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/index.html">02.Kubernetes实战指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03.Docker%E7%BB%8F%E5%85%B8%E5%AE%9E%E4%BE%8B/index.html">03.Docker经典实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04.Prometheus%E7%9B%91%E6%8E%A7%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/index.html">04.Prometheus监控运维实战</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">05.Kubernetes入门到实践</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/index.html">1.容器的发展史</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/index.html">2.Kubernetes的核心概念</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/index.html">3.Kubernetes的安装和部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4.Pod/index.html">4.Pod的基本操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5.%E6%8E%A7%E5%88%B6%E5%99%A8/index.html">5.控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6.Service%E5%92%8CIngress/index.html">6.Service和Ingress</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7.%E5%AD%98%E5%82%A8%E4%B8%8E%E9%85%8D%E7%BD%AE/index.html">7.存储与配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../8.Kubernetes%E8%B5%84%E6%BA%90%E7%9A%84%E7%AE%A1%E7%90%86%E5%8F%8A%E8%B0%83%E5%BA%A6/index.html">8.Kubernetes资源的管理及调度</a></li>
<li class="toctree-l2"><a class="reference internal" href="../9.API-Server/index.html">9.API-Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10.Kubernetes%E7%9A%84%E6%89%A9%E5%B1%95/index.html">10.Kubernetes的扩展</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">11.项目部署案例</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="1.%E6%97%A0%E7%8A%B6%E6%80%81%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B.html">无状态项目部署案例</a></li>
<li class="toctree-l3"><a class="reference internal" href="2.%E6%9C%89%E7%8A%B6%E6%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B.html">有状态项目的部署案例</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">使用Helm部署项目</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">1. Helm简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="#helm-chart">2. Helm Chart的基本操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">3. 使用Helm部署的项目案例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">4. Helm利器的优点</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">5. 实战 | Helm的使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#helm3-chart">6. Helm3 Chart多依赖微服务构建案例</a></li>
<li class="toctree-l4"><a class="reference internal" href="#helmharbor">7. Helm部署Harbor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#helmredis">8. Helm部署高可用redis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../12.Helm%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/index.html">12.Helm学习指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13.Kubernetes-DevOps/index.html">13.Kubernetes-DevOps</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">小健_Docker_K8s_Blog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">05.Kubernetes入门到实践</a> &raquo;</li>
          <li><a href="index.html">11.项目部署案例</a> &raquo;</li>
      <li>使用Helm部署项目</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/05.Kubernetes入门到实践/11.项目部署案例/3.使用Helm部署项目.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#helm" id="id13">使用Helm部署项目</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id14">1. Helm简介</a></p>
<ul>
<li><p><a class="reference internal" href="#helm-3-v3" id="id15">1.1 Helm 3 v3 变化</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id16">1.2 部署Helm客户端</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id17">1.3 Helm 命令自动补全</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id18">1.4 Helm常用命令</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#helm-chart" id="id19">2. Helm Chart的基本操作</a></p>
<ul>
<li><p><a class="reference internal" href="#chart" id="id20">2.1 Chart的创建</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id21">2.2 Chart的验证</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id22">2.3 Chart的发布</a></p></li>
<li><p><a class="reference internal" href="#template" id="id23">2.4 template 函数</a></p></li>
<li><p><a class="reference internal" href="#chartchart" id="id24">2.6 将Chart打包到Chart仓库中</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id25">2.7 发布版本的更新、回滚和删除</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id10" id="id26">3. 使用Helm部署的项目案例</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id27">4. Helm利器的优点</a></p></li>
<li><p><a class="reference internal" href="#id12" id="id28">5. 实战 | Helm的使用</a></p></li>
<li><p><a class="reference internal" href="#helm3-chart" id="id29">6. Helm3 Chart多依赖微服务构建案例</a></p></li>
<li><p><a class="reference internal" href="#helmharbor" id="id30">7. Helm部署Harbor</a></p></li>
<li><p><a class="reference internal" href="#helmredis" id="id31">8. Helm部署高可用redis</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="helm">
<h1><a class="toc-backref" href="#id13">使用Helm部署项目</a><a class="headerlink" href="#helm" title="Permalink to this headline">¶</a></h1>
<p>Kubernetes是一套容器集群管理系统，拥有自动包装、自我修复、横向缩放、服务发现和负载均衡、自动部署和升级回滚、存储编
排等特性，不仅支持Docker，还支持Rocket等容器。</p>
<p>我们可以发现Kubernetes的部署需要设置各式各样的模板文件，一个完整的应用程序会涉及多个Kubernetes
资源对象，而且为了描述这些对象要同时维护很多个yaml模板文件。不难发现，对于复杂的应用程序，在使用Kubernetes部署项目的
过程中会面临一些维护难题，如下所示。如何将这些分散而互相关联的应用模板文件作为一个整体统一管理？</p>
<ul class="simple">
<li><p>如何同时发布和重用这些应用模板文件？如何进行版本控制？</p></li>
<li><p>如何统一维护模板文件产生的各种资源（如Pod、Service、PVC等）？</p></li>
</ul>
<p><strong>而Helm正是以上问题的解决方案。</strong></p>
<section id="id1">
<h2><a class="toc-backref" href="#id14">1. Helm简介</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Helm是Kubernetes的一个子项目，是一种Kubernetes包管理平台。Helm能有效管理Kubernetes应用集合。使用Helm，可以轻松定
义、部署、升级非常复杂的Kubernetes应用集合，并进行版本管理。Helm具有对Kubernetes资源进行统一部署、删除、升级、回滚等强大功能。</p>
<section id="helm-3-v3">
<h3><a class="toc-backref" href="#id15">1.1 Helm 3 v3 变化</a><a class="headerlink" href="#helm-3-v3" title="Permalink to this headline">¶</a></h3>
<p>2019 年 11 月 13 日， Helm 团队发布 Helm v3 的第一个稳定版本。
该版本主要变化如下：</p>
<p>架构变化：</p>
<p>1、最明显的变化是 Tiller 的删除</p>
<p>2、Release 名称可以在不同命名空间重用</p>
<p>3、支持将 Chart 推送至 Docker 镜像仓库中</p>
<p>4、使用 JSONSchema 验证 chart values</p>
<p>5、其他</p>
<img alt="../../_images/image-20220421211353111.png" src="../../_images/image-20220421211353111.png" />
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id16">1.2 部署Helm客户端</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Helm
客户端下载地址：<a class="reference external" href="https://github.com/helm/helm/releases">https://github.com/helm/helm/releases</a>,解压移动到/usr/bin/目录即可。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ wget https://get.helm.sh/helm-v3.5.0-linux-amd64.tar.gz
$ tar zxvf helm-v3.5.0-linux-amd64.tar.gz
$ mv linux-amd64/helm /usr/bin/
</pre></div>
</div>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id17">1.3 Helm 命令自动补全</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="s2">&quot;source &lt;(helm completion bash)&quot;</span> &gt;&gt;  ~/.bash_profile
$ <span class="nb">source</span> ~/.bash_profile

<span class="c1"># bash-completion添加配置</span>
$ helm completion bash &gt; /usr/share/bash-completion/completions/helm
</pre></div>
</div>
<p>配置国内chart仓库</p>
<ul class="simple">
<li><p>微软仓库（<a class="reference external" href="http://mirror.azure.cn/kubernetes/charts/">http://mirror.azure.cn/kubernetes/charts/</a>）这个仓库推荐，基本上官网有的
chart 这里都有。</p></li>
<li><p>阿里云仓库（<a class="reference external" href="https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts">https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</a> ）</p></li>
<li><p>官方仓库（<a class="reference external" href="https://hub.kubeapps.com/charts/incubator">https://hub.kubeapps.com/charts/incubator</a>）官方 chart
仓库，国内有点不好使。</p></li>
</ul>
<p>添加存储库</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm repo add stable http://mirror.azure.cn/kubernetes/charts
$ helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
$ helm repo update
</pre></div>
</div>
<p>查看配置的存储库</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm repo list
$ helm search repo stable

<span class="c1"># helm列出软件所有版本/指定下载某版本</span>
$ helm search repo harbor/harbor -l
$ helm fetch harbor/harbor --version <span class="m">1</span>.7.2

<span class="c1"># 下载并解压pull和fetch等同</span>
$ helm pull harbor/harbor --version <span class="m">1</span>.7.2 --untar
$ helm fetch harbor/harbor --version <span class="m">1</span>.7.2 --untar
</pre></div>
</div>
<p>删除存储库：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm repo remove aliyun
</pre></div>
</div>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id18">1.4 Helm常用命令</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>参考文献：</p>
<p><a class="reference external" href="https://jicki.cn/helm-v3/#helm-v3-%E5%91%BD%E4%BB%A4">https://jicki.cn/helm-v3/#helm-v3-%E5%91%BD%E4%BB%A4</a></p>
</section>
</section>
<section id="helm-chart">
<h2><a class="toc-backref" href="#id19">2. Helm Chart的基本操作</a><a class="headerlink" href="#helm-chart" title="Permalink to this headline">¶</a></h2>
<section id="chart">
<h3><a class="toc-backref" href="#id20">2.1 Chart的创建</a><a class="headerlink" href="#chart" title="Permalink to this headline">¶</a></h3>
<p>要创建一个自定义Chart，执行以下命令即可。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm create examplechart
</pre></div>
</div>
<p>该命令会在当前目录下创建一个名为examplechart的子目录，其结构可以通过以下命令查看。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ tree examplechart/
examplechart/
├── charts
├── Chart.yaml
├── templates
│         ├── deployment.yaml
          ├── _helpers.tpl
          ├── hpa.yaml
│         ├── ingress.yaml
│         ├── NOTES.txt
│         ├── serviceaccount.yaml
│         ├── service.yaml
│         └── tests
│            └── test-connection.yaml
└── values.yaml

<span class="m">3</span> directories, <span class="m">10</span> files
</pre></div>
</div>
<p>它主要分为4个部分——charts目录、Chart.yaml、templates目录、values.yaml。</p>
<ul class="simple">
<li><p>charts目录</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>charts目录用于存放该Chart依赖的所有子Chart的目录，这些子Chart的目录也遵从目前的Chart文件结构（即拥有4个部分）。
如果有子Chart，则需要在父Chart中新建requirements.yaml文件，并在文件中记录这些子Chart。
在创建新Chart时默认没有依赖的子Chart。
</pre></div>
</div>
<p>helm3
v2版本中。已经将依赖requirements.yaml去掉，默认requirements.yaml的内容直接写入Chart.yaml中。</p>
<p>示例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v2</span>
<span class="n">appVersion</span><span class="p">:</span> <span class="mf">2.0</span><span class="o">.</span><span class="mi">0</span>
<span class="n">name</span><span class="p">:</span> <span class="n">foruda</span>
<span class="n">home</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitee</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
<span class="n">description</span><span class="p">:</span> <span class="n">foruda</span> <span class="n">ci</span> <span class="n">Helm</span> <span class="n">chart</span> <span class="k">for</span> <span class="n">Kubernetes</span>
<span class="n">icon</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitee</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">static</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">logo</span><span class="o">-</span><span class="n">black</span><span class="o">.</span><span class="n">svg</span>
<span class="n">keywords</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">foruda</span>
  <span class="o">-</span> <span class="n">ci</span>
  <span class="o">-</span> <span class="n">gitee</span><span class="o">-</span><span class="n">ci</span>
<span class="n">maintainers</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">foruda</span>
    <span class="n">email</span><span class="p">:</span> <span class="mi">1879324764</span><span class="nd">@qq</span><span class="o">.</span><span class="n">com</span>

<span class="n">sources</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitee</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">oschina</span><span class="o">/</span><span class="n">foruda</span><span class="o">-</span><span class="n">gitee</span><span class="o">-</span><span class="n">helm</span><span class="o">.</span><span class="n">git</span>
<span class="n">version</span><span class="p">:</span> <span class="mf">2.0</span><span class="o">.</span><span class="mi">0</span>

<span class="n">dependencies</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">postgres</span>
    <span class="n">repository</span><span class="p">:</span> <span class="n">file</span><span class="p">:</span><span class="o">//./</span><span class="n">charts</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span>
    <span class="n">version</span><span class="p">:</span> <span class="mf">2.0</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>如下所示的示例，是Wordpress Charts中定义的动态依赖关系：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mariadb</span>
  <span class="n">version</span><span class="p">:</span> <span class="mf">2.1</span><span class="o">.</span><span class="mi">1</span>
  <span class="n">repository</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">charts</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
  <span class="n">condition</span><span class="p">:</span> <span class="n">mariadb</span><span class="o">.</span><span class="n">enabled</span>
  <span class="n">tags</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">wordpress</span><span class="o">-</span><span class="n">database</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Chart.yaml</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Chart.yaml用于记录该Chart的关键信息，如名称、描述、版本等。该文件的内容如下所示。
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v2</span>
<span class="n">name</span><span class="p">:</span> <span class="n">examplechart</span>
<span class="n">description</span><span class="p">:</span> <span class="n">A</span> <span class="n">Helm</span> <span class="n">chart</span> <span class="k">for</span> <span class="n">Kubernetes</span>
<span class="nb">type</span><span class="p">:</span> <span class="n">application</span>
<span class="n">version</span><span class="p">:</span> <span class="mf">0.1</span><span class="o">.</span><span class="mi">0</span>
<span class="n">appVersion</span><span class="p">:</span> <span class="mf">1.16</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<ul class="simple">
<li><p>templates 目录</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>templates 目录中存放了Kubernetes部署文件的Helm模板，该模板并不完全等同于Kubernetes中的yaml模板，这里的模板扩展了Go
Template语法。
</pre></div>
</div>
<p>我们先来看看与要部署的应用有关的几个模板文件。首先是deployment.yaml文件，其内容如下所示。</p>
<p><code class="docutils literal notranslate"><span class="pre">deployment.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">include &quot;examplechart.fullname&quot; .</span> <span class="p p-Indicator">}}</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- include &quot;examplechart.labels&quot; . | nindent 4</span> <span class="p p-Indicator">}}</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="p p-Indicator">{{</span><span class="nv">- if not .Values.autoscaling.enabled</span> <span class="p p-Indicator">}}</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.Values.replicaCount</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="p p-Indicator">{{</span><span class="nv">- include &quot;examplechart.selectorLabels&quot; . | nindent 6</span> <span class="p p-Indicator">}}</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- with .Values.podAnnotations</span> <span class="p p-Indicator">}}</span>
      <span class="nt">annotations</span><span class="p">:</span>
        <span class="p p-Indicator">{{</span><span class="nv">- toYaml . | nindent 8</span> <span class="p p-Indicator">}}</span>
    <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="p p-Indicator">{{</span><span class="nv">- include &quot;examplechart.selectorLabels&quot; . | nindent 8</span> <span class="p p-Indicator">}}</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="p p-Indicator">{{</span><span class="nv">- with .Values.imagePullSecrets</span> <span class="p p-Indicator">}}</span>
      <span class="nt">imagePullSecrets</span><span class="p">:</span>
        <span class="p p-Indicator">{{</span><span class="nv">- toYaml . | nindent 8</span> <span class="p p-Indicator">}}</span>
      <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
      <span class="nt">serviceAccountName</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">include &quot;examplechart.serviceAccountName&quot; .</span> <span class="p p-Indicator">}}</span>
      <span class="nt">securityContext</span><span class="p">:</span>
        <span class="p p-Indicator">{{</span><span class="nv">- toYaml .Values.podSecurityContext | nindent 8</span> <span class="p p-Indicator">}}</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.Chart.Name</span> <span class="p p-Indicator">}}</span>
          <span class="nt">securityContext</span><span class="p">:</span>
            <span class="p p-Indicator">{{</span><span class="nv">- toYaml .Values.securityContext | nindent 12</span> <span class="p p-Indicator">}}</span>
          <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.image.repository</span><span class="nv"> </span><span class="s">}}:{{</span><span class="nv"> </span><span class="s">.Values.image.tag</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">.Chart.AppVersion</span><span class="nv"> </span><span class="s">}}&quot;</span>
          <span class="nt">imagePullPolicy</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.Values.image.pullPolicy</span> <span class="p p-Indicator">}}</span>
          <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
              <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
              <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
          <span class="nt">livenessProbe</span><span class="p">:</span>
            <span class="nt">httpGet</span><span class="p">:</span>
              <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
              <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
          <span class="nt">readinessProbe</span><span class="p">:</span>
            <span class="nt">httpGet</span><span class="p">:</span>
              <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
              <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
          <span class="nt">resources</span><span class="p">:</span>
            <span class="p p-Indicator">{{</span><span class="nv">- toYaml .Values.resources | nindent 12</span> <span class="p p-Indicator">}}</span>
      <span class="p p-Indicator">{{</span><span class="nv">- with .Values.nodeSelector</span> <span class="p p-Indicator">}}</span>
      <span class="nt">nodeSelector</span><span class="p">:</span>
        <span class="p p-Indicator">{{</span><span class="nv">- toYaml . | nindent 8</span> <span class="p p-Indicator">}}</span>
      <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
      <span class="p p-Indicator">{{</span><span class="nv">- with .Values.affinity</span> <span class="p p-Indicator">}}</span>
      <span class="nt">affinity</span><span class="p">:</span>
        <span class="p p-Indicator">{{</span><span class="nv">- toYaml . | nindent 8</span> <span class="p p-Indicator">}}</span>
      <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
      <span class="p p-Indicator">{{</span><span class="nv">- with .Values.tolerations</span> <span class="p p-Indicator">}}</span>
      <span class="nt">tolerations</span><span class="p">:</span>
        <span class="p p-Indicator">{{</span><span class="nv">- toYaml . | nindent 8</span> <span class="p p-Indicator">}}</span>
      <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
</pre></div>
</div>
<p>这是一个示例性质的yaml模板。和普通模板的区别在于，其中有很多属性值是用两个大括号括起来的，被双大括号括起来的部分是Go
Template，<strong>大括号中以.Values开头的属性值是在values.yaml文件中定义的</strong>，<strong>而其他的属性（如以.Chart开头的属性）则是在</strong>
<strong>Chart.yaml中定义的内容</strong>，而以.Release开头的属性则依赖于发布版本部署时的实际值。通过Go
Template，可以使模板的具体部署操作和部署参数分离开来，各自单独维护。</p>
<p>然后，查看service.yaml文件</p>
<p><code class="docutils literal notranslate"><span class="pre">service.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">include &quot;examplechart.fullname&quot; .</span> <span class="p p-Indicator">}}</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- include &quot;examplechart.labels&quot; . | nindent 4</span> <span class="p p-Indicator">}}</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.Values.service.type</span> <span class="p p-Indicator">}}</span>
  <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">port</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.Values.service.port</span> <span class="p p-Indicator">}}</span>
      <span class="nt">targetPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
      <span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- include &quot;examplechart.selectorLabels&quot; . | nindent 4</span> <span class="p p-Indicator">}}</span>
</pre></div>
</div>
<p>可以看到它定义了一个基于上述Deployment控制器的Service。和Deployment控制器的定义类似，里面有很多值取决于其他处的引用。</p>
<p>接下来，查看ingress.yaml文件，因为示例模板中默认不启用Ingress，所以这里只列出该文件中的前面几行以进行说明。
ingress.yaml文件的前几行如下所示。</p>
<p><code class="docutils literal notranslate"><span class="pre">ingress.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="nv">- if .Values.ingress.enabled -</span><span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class="nv">- $fullName</span> <span class="p p-Indicator">:</span><span class="nv">= include &quot;examplechart.fullname&quot; . -</span><span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class="nv">- $svcPort</span> <span class="p p-Indicator">:</span><span class="nv">= .Values.service.port -</span><span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class="nv">- if semverCompare &quot;&gt;=1.14-0&quot; .Capabilities.KubeVersion.GitVersion -</span><span class="p p-Indicator">}}</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1beta1</span>
<span class="p p-Indicator">{{</span><span class="nv">- else -</span><span class="p p-Indicator">}}</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">$fullName</span> <span class="p p-Indicator">}}</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- include &quot;examplechart.labels&quot; . | nindent 4</span> <span class="p p-Indicator">}}</span>
  <span class="p p-Indicator">{{</span><span class="nv">- with .Values.ingress.annotations</span> <span class="p p-Indicator">}}</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- toYaml . | nindent 4</span> <span class="p p-Indicator">}}</span>
  <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="p p-Indicator">{{</span><span class="nv">- if .Values.ingress.tls</span> <span class="p p-Indicator">}}</span>
  <span class="nt">tls</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- range .Values.ingress.tls</span> <span class="p p-Indicator">}}</span>
    <span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span>
        <span class="p p-Indicator">{{</span><span class="nv">- range .hosts</span> <span class="p p-Indicator">}}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{{</span> <span class="nv">. | quote</span> <span class="p p-Indicator">}}</span>
        <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
      <span class="nt">secretName</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.secretName</span> <span class="p p-Indicator">}}</span>
    <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
  <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
  <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- range .Values.ingress.hosts</span> <span class="p p-Indicator">}}</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.host | quote</span> <span class="p p-Indicator">}}</span>
      <span class="nt">http</span><span class="p">:</span>
        <span class="nt">paths</span><span class="p">:</span>
          <span class="p p-Indicator">{{</span><span class="nv">- range .paths</span> <span class="p p-Indicator">}}</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">.</span> <span class="p p-Indicator">}}</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">$fullName</span> <span class="p p-Indicator">}}</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">$svcPort</span> <span class="p p-Indicator">}}</span>
          <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
    <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
  <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
</pre></div>
</div>
<p>定义Ingress的方式与之前定义Deployment控制器和Service的方式差不多，但最大区别在于，</p>
<p>其模板首行为{{- if.Values.ingress.enabled
-}}，这表示只有当values.yaml文件中ingress.enabled属性为true时，该模板才生效。</p>
<p>最后一个与要部署的应用有关的文件是_helpers.tpl，它是一个模板助手文件。该文件主要用于定义通用信息（比如，命名和设置标
签），然后在其他地方使用。之前的各个模板都引用了_helpers.tpl中定义的命名信息和标签信息。_helpers.tpl文件的内容如下所示。</p>
<p><code class="docutils literal notranslate"><span class="pre">_helpers.tpl</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{{/* vim: set filetype=mustache: */}}
{{/*
对Chart的名称进行扩展
*/}}
{{- define &quot;examplechart.name&quot; -}}
{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix &quot;-&quot; }}
{{- end }}

{{/*
创建一个默认基于一定规则的应用全名，
字符的最大长度为63，超过该数值会被截断，因为一些Kubernetes名称字段拥有这样的限制（根据DNS命名规范）
如果发布（release）对象的名称已经包含Chart名称，则将前者作为全名
*/}}
{{- define &quot;examplechart.fullname&quot; -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix &quot;-&quot; }}
{{- else }}
{{- $name := default .Chart.Name .Values.nameOverride }}
{{- if contains $name .Release.Name }}
{{- .Release.Name | trunc 63 | trimSuffix &quot;-&quot; }}
{{- else }}
{{- printf &quot;%s-%s&quot; .Release.Name $name | trunc 63 | trimSuffix &quot;-&quot; }}
{{- end }}
{{- end }}
{{- end }}

{{/*
根据Chart标签创建Chart名称和版本
*/}}
{{- define &quot;examplechart.chart&quot; -}}
{{- printf &quot;%s-%s&quot; .Chart.Name .Chart.Version | replace &quot;+&quot; &quot;_&quot; | trunc 63 | trimSuffix &quot;-&quot; }}
{{- end }}

{{/*
常用标签
*/}}
{{- define &quot;examplechart.labels&quot; -}}
helm.sh/chart: {{ include &quot;examplechart.chart&quot; . }}
{{ include &quot;examplechart.selectorLabels&quot; . }}
{{- if .Chart.AppVersion }}
app.kubernetes.io/version: {{ .Chart.AppVersion | quote }}
{{- end }}
app.kubernetes.io/managed-by: {{ .Release.Service }}
{{- end }}

{{/*
选择器标签
*/}}
{{- define &quot;examplechart.selectorLabels&quot; -}}
app.kubernetes.io/name: {{ include &quot;examplechart.name&quot; . }}
app.kubernetes.io/instance: {{ .Release.Name }}
{{- end }}

{{/*
创建要使用的服务账户的名称
*/}}
{{- define &quot;examplechart.serviceAccountName&quot; -}}
{{- if .Values.serviceAccount.create }}
{{- default (include &quot;examplechart.fullname&quot; .) .Values.serviceAccount.name }}
{{- else }}
{{- default &quot;default&quot; .Values.serviceAccount.name }}
{{- end }}
{{- end }}
</pre></div>
</div>
<p>以上文件已经定义了要部署的应用的全部内容。</p>
<p>另外还有两个附加文件，它们在部署后产生说明文档和部署检查。</p>
<p><code class="docutils literal notranslate"><span class="pre">NOTES.txt</span></code></p>
<p>在执行Chart部署命令后，它会代入具体的参数值，产生说明信息。该文件主要讲述的是用户如何操作
才能访问Service，并根据不同的Service类型进行了不同的分支处理和内容输出。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. Get the application URL by running these commands:
{{- if .Values.ingress.enabled }}
{{- range $host := .Values.ingress.hosts }}
  {{- range .paths }}
  http{{ if $.Values.ingress.tls }}s{{ end }}://{{ $host.host }}{{ . }}
  {{- end }}
{{- end }}
{{- else if contains &quot;NodePort&quot; .Values.service.type }}
  export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath=&quot;{.spec.ports[0].nodePort}&quot; services {{ include &quot;examplechart.fullname&quot; . }})
  export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath=&quot;{.items[0].status.addresses[0].address}&quot;)
  echo http://$NODE_IP:$NODE_PORT
{{- else if contains &quot;LoadBalancer&quot; .Values.service.type }}
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running &#39;kubectl get --namespace {{ .Release.Namespace }} svc -w {{ include &quot;examplechart.fullname&quot; . }}&#39;
  export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include &quot;examplechart.fullname&quot; . }} --template &quot;{{&quot;{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}&quot;}}&quot;)
  echo http://$SERVICE_IP:{{ .Values.service.port }}
{{- else if contains &quot;ClusterIP&quot; .Values.service.type }}
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l &quot;app.kubernetes.io/name={{ include &quot;examplechart.name&quot; . }},app.kubernetes.io/instance={{ .Release.Name }}&quot; -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
  echo &quot;Visit http://127.0.0.1:8080 to use your application&quot;
  kubectl --namespace {{ .Release.Namespace }} port-forward $POD_NAME 8080:80
{{- end }}
</pre></div>
</div>
<p>第二个附加文件是tests目录下的test-connection.yaml文件。它用于定义部署完成后需要执行的测试内容，以便验证应用是否已成功部署。test-connection.yaml文件的内容如下所示。</p>
<p><code class="docutils literal notranslate"><span class="pre">test-connection.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">&quot;</span><span class="l l-Scalar l-Scalar-Plain">examplechart.fullname&quot; . }}-test-connection&quot;</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="p p-Indicator">{{</span><span class="nv">- include &quot;examplechart.labels&quot; . | nindent 4</span> <span class="p p-Indicator">}}</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="s">&quot;helm.sh/hook&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">test-success</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wget</span>
      <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">busybox</span>
      <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;wget&#39;</span><span class="p p-Indicator">]</span>
      <span class="nt">args</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">&quot;examplechart.fullname&quot;</span><span class="nv"> </span><span class="s">.</span><span class="nv"> </span><span class="s">}}:{{</span><span class="nv"> </span><span class="s">.Values.service.port</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="p p-Indicator">]</span>
  <span class="nt">restartPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Never</span>
</pre></div>
</div>
<p>可以看到它的镜像为busybox，它会执行wget命令，测试部署的Service是否可以正常访问。</p>
<p>接下来，我们来看看values.yaml文件，在这个文件中定义了以上所有模板需要的具体部署参数值。</p>
<p>values.yaml文件的内容如下所示。</p>
<p><code class="docutils literal notranslate"><span class="pre">values.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">replicaCount</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">image</span><span class="p">:</span>
  <span class="nt">repository</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">pullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
  <span class="nt">tag</span><span class="p">:</span> <span class="s">&quot;&quot;</span>

<span class="nt">imagePullSecrets</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
<span class="nt">nameOverride</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
<span class="nt">fullnameOverride</span><span class="p">:</span> <span class="s">&quot;&quot;</span>

<span class="nt">serviceAccount</span><span class="p">:</span>
  <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">annotations</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;&quot;</span>

<span class="nt">podAnnotations</span><span class="p">:</span> <span class="p p-Indicator">{}</span>

<span class="nt">podSecurityContext</span><span class="p">:</span> <span class="p p-Indicator">{}</span>

<span class="nt">securityContext</span><span class="p">:</span> <span class="p p-Indicator">{}</span>

<span class="nt">service</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>

<span class="nt">ingress</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">annotations</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">hosts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chart-example.local</span>
      <span class="nt">paths</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
  <span class="nt">tls</span><span class="p">:</span> <span class="p p-Indicator">[]</span>


<span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
<span class="nt">autoscaling</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">minReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">maxReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
  <span class="nt">targetCPUUtilizationPercentage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>

<span class="nt">nodeSelector</span><span class="p">:</span> <span class="p p-Indicator">{}</span>

<span class="nt">tolerations</span><span class="p">:</span> <span class="p p-Indicator">[]</span>

<span class="nt">affinity</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
</pre></div>
</div>
<p>将这些值分别代入之前的模板，可以发现examplechart的整个示例模板定义的是一个使用Nginx作为镜像的Deployment控制器，其副本
数量为1。基于该Deployment控制器创建了一个Service，其类型为ClusterIP，端口为80。Ingress默认没有启用。</p>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id21">2.2 Chart的验证</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>在发布之前，可以通过以下命令检查Chart文件的依赖项和模板配置是否正确。如果文件格式错误，可以根据提示进行修改。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm lint examplechart/
<span class="o">==</span>&gt; Linting examplechart/
<span class="o">[</span>INFO<span class="o">]</span> Chart.yaml: icon is recommended

<span class="m">1</span> chart<span class="o">(</span>s<span class="o">)</span> linted, <span class="m">0</span> chart<span class="o">(</span>s<span class="o">)</span> failed
</pre></div>
</div>
<p>Chart文件没有任何错误。</p>
<section id="id6">
<h4>1. 渲染模板<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>如果想查看通过指定的参数渲染的 Kubernetes
部署资源模板，可以通过下面命令：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm template examplechart -n <span class="nb">test</span>
</pre></div>
</div>
<p>可以看到渲染的模板如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="c1"># Source: examplechart/templates/serviceaccount.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span><span class="o">-</span><span class="n">examplechart</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">helm</span><span class="o">.</span><span class="n">sh</span><span class="o">/</span><span class="n">chart</span><span class="p">:</span> <span class="n">examplechart</span><span class="o">-</span><span class="mf">0.2</span><span class="o">.</span><span class="mi">0</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">name</span><span class="p">:</span> <span class="n">examplechart</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">instance</span><span class="p">:</span> <span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">version</span><span class="p">:</span> <span class="s2">&quot;1.16.0&quot;</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">managed</span><span class="o">-</span><span class="n">by</span><span class="p">:</span> <span class="n">Helm</span>
<span class="o">---</span>
<span class="c1"># Source: examplechart/templates/service.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span><span class="o">-</span><span class="n">examplechart</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">helm</span><span class="o">.</span><span class="n">sh</span><span class="o">/</span><span class="n">chart</span><span class="p">:</span> <span class="n">examplechart</span><span class="o">-</span><span class="mf">0.2</span><span class="o">.</span><span class="mi">0</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">name</span><span class="p">:</span> <span class="n">examplechart</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">instance</span><span class="p">:</span> <span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">version</span><span class="p">:</span> <span class="s2">&quot;1.16.0&quot;</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">managed</span><span class="o">-</span><span class="n">by</span><span class="p">:</span> <span class="n">Helm</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="nb">type</span><span class="p">:</span> <span class="n">ClusterIP</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">port</span><span class="p">:</span> <span class="mi">80</span>
      <span class="n">targetPort</span><span class="p">:</span> <span class="n">http</span>
      <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">http</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">name</span><span class="p">:</span> <span class="n">examplechart</span>
    <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">instance</span><span class="p">:</span> <span class="n">RELEASE</span><span class="o">-</span><span class="n">NAME</span>
<span class="o">---</span>
<span class="o">......</span>
</pre></div>
</div>
</section>
<section id="id7">
<h4>2. 预热模板<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>在使用Helm进行实际部署时，实际上将Chart文件解析为Kubernetes能够识别的各种资源的yaml模板文件以进行部署。</p>
<p>可以使用<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">helm</span> <span class="pre">install</span> <span class="pre">--dry-run</span> <span class="pre">--debug</span> <span class="pre">{Chart文件目录}</span></code>命令来验证Chart配置。命令执行后输出的内容为最终Kubernetes中Helm各模板与参数值合成在一起的yaml模板文件，可以用该文件来检查Chart的部署行为是否符合预期。</p>
<p>真正会在Kubernetes集群中执行的模板内容</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm install examplerelease ./examplechart -n <span class="nb">test</span> --dry-run --debug
install.go:159: <span class="o">[</span>debug<span class="o">]</span> Original chart version: <span class="s2">&quot;&quot;</span>
install.go:176: <span class="o">[</span>debug<span class="o">]</span> CHART PATH: /data/jenkins/gitee_workspace_parallel/kubernets_practice_2022/helm/examplechart

NAME: examplerelease
LAST DEPLOYED: Thu Apr <span class="m">21</span> <span class="m">21</span>:41:51 <span class="m">2022</span>
NAMESPACE: default
STATUS: pending-install
REVISION: <span class="m">1</span>
USER-SUPPLIED VALUES:
<span class="o">{}</span>

COMPUTED VALUES:
affinity: <span class="o">{}</span>
autoscaling:
  enabled: <span class="nb">false</span>
  maxReplicas: <span class="m">100</span>
  minReplicas: <span class="m">1</span>
  targetCPUUtilizationPercentage: <span class="m">80</span>
fullnameOverride: <span class="s2">&quot;&quot;</span>
image:
  pullPolicy: IfNotPresent
  repository: nginx
  tag: <span class="s2">&quot;&quot;</span>
imagePullSecrets: <span class="o">[]</span>
ingress:
  annotations: <span class="o">{}</span>
  enabled: <span class="nb">false</span>
  hosts:
  - host: chart-example.local
    paths: <span class="o">[]</span>
  tls: <span class="o">[]</span>
nameOverride: <span class="s2">&quot;&quot;</span>
nodeSelector: <span class="o">{}</span>
podAnnotations: <span class="o">{}</span>
podSecurityContext: <span class="o">{}</span>
replicaCount: <span class="m">1</span>
resources: <span class="o">{}</span>
securityContext: <span class="o">{}</span>
service:
  port: <span class="m">80</span>
  type: ClusterIP
serviceAccount:
  annotations: <span class="o">{}</span>
  create: <span class="nb">true</span>
  name: <span class="s2">&quot;&quot;</span>
tolerations: <span class="o">[]</span>

HOOKS:
---
<span class="c1"># Source: examplechart/templates/tests/test-connection.yaml</span>
apiVersion: v1
kind: Pod
metadata:
  name: <span class="s2">&quot;examplerelease-examplechart-test-connection&quot;</span>
  labels:
    helm.sh/chart: examplechart-0.1.0
    app.kubernetes.io/name: examplechart
    app.kubernetes.io/instance: examplerelease
    app.kubernetes.io/version: <span class="s2">&quot;1.16.0&quot;</span>
    app.kubernetes.io/managed-by: Helm
  annotations:
    <span class="s2">&quot;helm.sh/hook&quot;</span>: test-success
spec:
  containers:
    - name: wget
      image: busybox
      command: <span class="o">[</span><span class="s1">&#39;wget&#39;</span><span class="o">]</span>
      args: <span class="o">[</span><span class="s1">&#39;examplerelease-examplechart:80&#39;</span><span class="o">]</span>
  restartPolicy: Never
MANIFEST:
---
<span class="c1"># Source: examplechart/templates/serviceaccount.yaml</span>
apiVersion: v1
kind: ServiceAccount
metadata:
  name: examplerelease-examplechart
  labels:
    helm.sh/chart: examplechart-0.1.0
    app.kubernetes.io/name: examplechart
    app.kubernetes.io/instance: examplerelease
    app.kubernetes.io/version: <span class="s2">&quot;1.16.0&quot;</span>
    app.kubernetes.io/managed-by: Helm
---
<span class="c1"># Source: examplechart/templates/service.yaml</span>
apiVersion: v1
kind: Service
metadata:
  name: examplerelease-examplechart
  labels:
    helm.sh/chart: examplechart-0.1.0
    app.kubernetes.io/name: examplechart
    app.kubernetes.io/instance: examplerelease
    app.kubernetes.io/version: <span class="s2">&quot;1.16.0&quot;</span>
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: <span class="m">80</span>
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: examplechart
    app.kubernetes.io/instance: examplerelease
---
<span class="c1"># Source: examplechart/templates/deployment.yaml</span>
apiVersion: apps/v1
kind: Deployment
metadata:
  name: examplerelease-examplechart
  labels:
    helm.sh/chart: examplechart-0.1.0
    app.kubernetes.io/name: examplechart
    app.kubernetes.io/instance: examplerelease
    app.kubernetes.io/version: <span class="s2">&quot;1.16.0&quot;</span>
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: <span class="m">1</span>
  selector:
    matchLabels:
      app.kubernetes.io/name: examplechart
      app.kubernetes.io/instance: examplerelease
  template:
    metadata:
      labels:
        app.kubernetes.io/name: examplechart
        app.kubernetes.io/instance: examplerelease
    spec:
      serviceAccountName: examplerelease-examplechart
      securityContext:
        <span class="o">{}</span>
      containers:
        - name: examplechart
          securityContext:
            <span class="o">{}</span>
          image: <span class="s2">&quot;nginx:1.16.0&quot;</span>
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: <span class="m">80</span>
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          resources:
            <span class="o">{}</span>

NOTES:
<span class="m">1</span>. Get the application URL by running these commands:
  <span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl get pods --namespace default -l <span class="s2">&quot;app.kubernetes.io/name=examplechart,app.kubernetes.io/instance=examplerelease&quot;</span> -o j             <span class="nv">sonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].metadata.name}&quot;</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;Visit http://127.0.0.1:8080 to use your application&quot;</span>
  kubectl --namespace default port-forward <span class="nv">$POD_NAME</span> <span class="m">8080</span>:80
</pre></div>
</div>
<p>指定安装名称的方式</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm install my-release bitnami/&lt;chart&gt;           <span class="c1"># Helm 3</span>
$ helm install --name my-release bitnami/&lt;chart&gt;    <span class="c1"># Helm 2</span>
</pre></div>
</div>
<p>命令中通过指定了发布对象的名称为examplerelease。名称空间为test
如果没有指定，会生成一个随机名称。</p>
</section>
</section>
<section id="id8">
<h3><a class="toc-backref" href="#id22">2.3 Chart的发布</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>可以通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">helm</span> <span class="pre">install</span> <span class="pre">{Chart名称}</span></code>
命令将Chart发布到Kubernetes集群中。</p>
<p>在本例中，执行的命令如下。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl create ns <span class="nb">test</span>
$ helm install examplerelease examplechart -n <span class="nb">test</span>
</pre></div>
</div>
<p>有五种不同的方式来标识需要安装的chart：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.通过chart引用： helm install mymaria example/mariadb

2.通过chart包： helm install mynginx ./nginx-1.2.3.tgz

3.通过未打包chart目录的路径： helm install mynginx ./nginx
- 基于本地Chart目录的values文件部署：helm install -f values.yaml -n ci-gitee-nginx ci-gitee-nginx ./

4.通过URL绝对路径： helm install mynginx https://example.com/charts/nginx-1.2.3.tgz

5.通过chart引用和仓库url： helm install —repo https://example.com/charts/ mynginx nginx
</pre></div>
</div>
<p>Chart发布后，可以通过$ helm list命令查看当前集群下的所有发布版本。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>NAME: examplerelease
LAST DEPLOYED: Thu Apr <span class="m">21</span> <span class="m">21</span>:50:57 <span class="m">2022</span>
NAMESPACE: <span class="nb">test</span>
STATUS: deployed
REVISION: <span class="m">1</span>
NOTES:
<span class="m">1</span>. Get the application URL by running these commands:
  <span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl get pods --namespace <span class="nb">test</span> -l <span class="s2">&quot;app.kubernetes.io/name=examplechart,app.kubernetes.io/instance=examplerelease&quot;</span> -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].metadata.name}&quot;</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;Visit http://127.0.0.1:8080 to use your application&quot;</span>
  kubectl --namespace <span class="nb">test</span> port-forward <span class="nv">$POD_NAME</span> <span class="m">8080</span>:80

$ helm list -A <span class="p">|</span>grep <span class="nb">test</span>
examplerelease                  <span class="nb">test</span>                    <span class="m">1</span>               <span class="m">2022</span>-04-21 <span class="m">21</span>:50:57.768761091 +0800 CST deployed        examplechart-0.1.0              <span class="m">1</span>.16.0
</pre></div>
</div>
<p>发布版本的列表如上所示。可以看到一个名为examplerelease的发布版本，其状态为已部署，所使用的Chart为examplechart-0.1.0。</p>
<p>当相关Pod处于运行状态后，就可以通过Service进行访问了。Service类型为ClusterIP，其虚拟IP地址为
10.102.136.55，端口为80。此时可以用集群中的某台机器通过“{ServiceIP}:{端口}”访问Nginx。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># master节点或者node节点</span>
$ curl <span class="m">10</span>.102.136.55
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body <span class="o">{</span>
        width: 35em<span class="p">;</span>
        margin: <span class="m">0</span> auto<span class="p">;</span>
        font-family: Tahoma, Verdana, Arial, sans-serif<span class="p">;</span>
    <span class="o">}</span>
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you <span class="k">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>当然，也可以根据NOTES中的提示，依次执行提示中的2条命令，以便直接使用127.0.0.1:8080进行访问。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace test -l &quot;app.kubernetes.io/name=examplechart,app.kubernetes.io/instance=examplerelease&quot; -o json[0].metadata.name}&quot;)
  echo &quot;Visit http://127.0.0.1:8080 to use your application&quot;
  kubectl --namespace test port-forward $POD_NAME 8080:80
</pre></div>
</div>
<p>在使用Helm前，如果要查看某个应用在Kubernetes上的资源，就要记住这个应用有哪些资源，</p>
<p>然后依次执行<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">get</span></code>命令查看各个资源的状态，本例中的应用拥有3种类型的资源（Deployment控
制器、Pod和Service）。如果没有用Helm进行部署，就需要依次执行kubectl
get命令来查看状态</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl get deployment -n <span class="nb">test</span>
NAME                          READY   UP-TO-DATE   AVAILABLE   AGE
examplerelease-examplechart   <span class="m">1</span>/1     <span class="m">1</span>            <span class="m">1</span>           2m37s

$ kubectl get svc -n <span class="nb">test</span>
NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>   AGE
examplerelease-examplechart   ClusterIP   <span class="m">10</span>.102.136.55   &lt;none&gt;        <span class="m">80</span>/TCP    2m40s

$ kubectl get pod -n <span class="nb">test</span>
NAME                                           READY   STATUS    RESTARTS   AGE
examplerelease-examplechart-78688d8d87-5dpcp   <span class="m">1</span>/1     Running   <span class="m">0</span>          6m2s
</pre></div>
</div>
<p>使用Helm后，可以只通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">helm</span> <span class="pre">status</span> <span class="pre">examplerelease</span></code>命令来查看某个发布版本下所有Kubernetes资源的状态了。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm status examplerelease -n <span class="nb">test</span>
NAME: examplerelease
LAST DEPLOYED: Thu Apr <span class="m">21</span> <span class="m">21</span>:50:57 <span class="m">2022</span>
NAMESPACE: <span class="nb">test</span>
STATUS: deployed
REVISION: <span class="m">1</span>
NOTES:
<span class="m">1</span>. Get the application URL by running these commands:
  <span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl get pods --namespace <span class="nb">test</span> -l <span class="s2">&quot;app.kubernetes.io/name=examplechart,app.kubernetes.io/instance=examplerelease&quot;</span> -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].metadata.name}&quot;</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;Visit http://127.0.0.1:8080 to use your application&quot;</span>
  kubectl --namespace <span class="nb">test</span> port-forward <span class="nv">$POD_NAME</span> <span class="m">8080</span>:80
</pre></div>
</div>
</section>
<section id="template">
<h3><a class="toc-backref" href="#id23">2.4 template 函数</a><a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h3>
<p>参考文献</p>
<p><a class="reference external" href="https://jicki.cn/helm-chart/#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6">https://jicki.cn/helm-chart/#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6</a></p>
</section>
<section id="chartchart">
<h3><a class="toc-backref" href="#id24">2.6 将Chart打包到Chart仓库中</a><a class="headerlink" href="#chartchart" title="Permalink to this headline">¶</a></h3>
<p>在初始化Helm时会默认使用两个Chart仓库，一个是本地仓库，另一个远程仓库。可以通过以下命令查看当前Helm配置的Chart仓库列
表。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm repo list
NAME            URL
ingress-nginx   https://kubernetes.github.io/ingress-nginx
stable          http://mirror.azure.cn/kubernetes/charts
cilium          https://helm.cilium.io/
gitee-helm      http://hub.gitee.cc/chartrepo/gitee-helm
harbor          https://helm.goharbor.io
azure           http://mirror.azure.cn/kubernetes/charts/
bitnami         https://charts.bitnami.com/bitnami
aliyun          https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
</pre></div>
</div>
<p>接下来，执行以下命令将之前创建的Chart文件以TAR格式压缩成Chart包，并存放到本地仓库中。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm package examplechart
Successfully packaged chart and saved it to: /data/jenkins/gitee_workspace_parallel/kubernets_practice_2022/helm/examplechart-0.1.0.tgz
</pre></div>
</div>
<p>这表明Chart包已成功生成。</p>
<p>打包完成后，可以将完成Chart上传，也可以为helm添加向仓库推送Chart的push插件，以便直接通过命令行完成Chart上传。Helm的插件管理子命令为plugin，下面的命令就用于安装push插件。</p>
<p>helm(3.0.3)现在默认不支持推送到charts库，需要安装插件helm-push</p>
<p><a class="reference external" href="https://github.com/chartmuseum/helm-push">https://github.com/chartmuseum/helm-push</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ helm plugin install https://github.com/chartmuseum/helm-push
Downloading and installing helm-push v0.9.0 ...
https://github.com/chartmuseum/helm-push/releases/download/v0.9.0/helm-push_0.9.0_linux_amd64.tar.gz
Installed plugin: push
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm push examplechart-0.1.0.tgz gitee-helm --username gxixxe  --password <span class="m">12345</span>
Pushing examplechart-0.1.0.tgz to gitee-helm...
Done.
</pre></div>
</div>
<p>出现以上就说明 push 成功了</p>
<img alt="../../_images/image-20220421220701261.png" src="../../_images/image-20220421220701261.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># 更新
$ helm repo update

# 下载
$ helm pull gitee-helm/examplechart
</pre></div>
</div>
<p>可以执行以下命令查询远程仓库和本地仓库中所有名为examplechart的Chart包。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm search repo examplechart
NAME                    CHART VERSION   APP VERSION     DESCRIPTION
gitee-helm/examplechart <span class="m">0</span>.1.0           <span class="m">1</span>.16.0          A Helm chart <span class="k">for</span> Kubernetes
</pre></div>
</div>
<p>可以看到已成功查询出刚才生成的Chart包，其名称为gitee-helm/examplechart。</p>
<p>假设现在要对examplechart进行升级，并将更新后的Chart文件重新打包到本地仓库中，那么需要编辑Chart文件目录下之前的各个模
板，并修改Chart.yaml文件和更改Chart的整体版本号。首先，通过以下命令打开之前创建的Chart.yaml文件。</p>
<p><code class="docutils literal notranslate"><span class="pre">examplechart/Chart.yaml</span></code></p>
<p>然后，编辑文件内容，将version字段由原先的0.1.0修改为0.2.0，并保存文件。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v2</span>
<span class="n">name</span><span class="p">:</span> <span class="n">examplechart</span>
<span class="n">description</span><span class="p">:</span> <span class="n">A</span> <span class="n">Helm</span> <span class="n">chart</span> <span class="k">for</span> <span class="n">Kubernetes</span>
<span class="nb">type</span><span class="p">:</span> <span class="n">application</span>
<span class="n">version</span><span class="p">:</span> <span class="mf">0.2</span><span class="o">.</span><span class="mi">0</span>
<span class="n">appVersion</span><span class="p">:</span> <span class="mf">1.16</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>接下来，再次执行helm package
examplechart命令，将Chart文件打包并存放到本地仓库中。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm package examplechart
</pre></div>
</div>
<p>此时再通过以下命令查询仓库中名为examplechart的Chart包。若命令中有–versions参数，则将会查询出examplechart中所有版本
的Chart包；如果不带–versions参数，只会查询出一条最新版本的Chart包。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm push examplechart-0.2.0.tgz gitee-helm --username gitee  --password Oschina123
Pushing examplechart-0.2.0.tgz to gitee-helm...
Done.

$ helm repo update

$ helm search repo examplechart
NAME                    CHART VERSION   APP VERSION     DESCRIPTION
gitee-helm/examplechart <span class="m">0</span>.2.0           <span class="m">1</span>.16.0          A Helm chart <span class="k">for</span> Kubernetes

$ helm search repo examplechart --versions
NAME                    CHART VERSION   APP VERSION     DESCRIPTION
gitee-helm/examplechart <span class="m">0</span>.2.0           <span class="m">1</span>.16.0          A Helm chart <span class="k">for</span> Kubernetes
gitee-helm/examplechart <span class="m">0</span>.1.0           <span class="m">1</span>.16.0          A Helm chart <span class="k">for</span> Kubernetes
</pre></div>
</div>
<p>可以看到本地仓库中包含两名为examplechart的Chart包，最新版本为0.2.0，旧版本为0.1.0。</p>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id25">2.7 发布版本的更新、回滚和删除</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>现在examplechart在本地仓库中分别有0.1.0和0.2.0两个版本。在之前我们已经发布了0.1.0版本，现在可以更新之前部署的名为
examplerelease的发布版本，将其升级为examplechart 0.2.0版本。</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">helm</span> <span class="pre">upgrade</span></code>命令将已部署的名为examplerelease的发布版本更新到最新版本。</p>
<p>可以通过–version参数指定需要更新的版本号（如–version
0.2.0）。如果没有指定
版本号，Helm默认会使用最新版本进行更新。具体命令如下所示。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$  helm upgrade examplerelease gitee-helm/examplechart -n <span class="nb">test</span>
Release <span class="s2">&quot;examplerelease&quot;</span> has been upgraded. Happy Helming!
NAME: examplerelease
LAST DEPLOYED: Thu Apr <span class="m">21</span> <span class="m">22</span>:14:53 <span class="m">2022</span>
NAMESPACE: <span class="nb">test</span>
STATUS: deployed
REVISION: <span class="m">2</span>
NOTES:
<span class="m">1</span>. Get the application URL by running these commands:
  <span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl get pods --namespace <span class="nb">test</span> -l <span class="s2">&quot;app.kubernetes.io/name=examplechart,app.kubernetes.io/instance=examplerelease&quot;</span> -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].metadata.name}&quot;</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;Visit http://127.0.0.1:8080 to use your application&quot;</span>
  kubectl --namespace <span class="nb">test</span> port-forward <span class="nv">$POD_NAME</span> <span class="m">8080</span>:80
</pre></div>
</div>
<p>这表明examplerelease发布版本已更新为最新版本的examplechart。</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">helm</span> <span class="pre">list</span></code>命令查看发布版本的列表可以发现，REVISION字段由1变成2，表示变更记录了两次；而CHART字段的值为
examplechart-0.2.0，表示已升级到最新版本。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ helm list -A |grep examplerelease
examplerelease                  test                    2               2022-04-21 22:14:53.28957309 +0800 CST  deployed        examplechart-0.2.0           1.16.0
</pre></div>
</div>
<p>如果版本升级后存在问题，需要回滚到旧版本。可以先执行以下命令查看某个发布版本中的所有变更记录。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm <span class="nb">history</span> examplerelease -n <span class="nb">test</span>
REVISION        UPDATED                         STATUS          CHART                   APP VERSION     DESCRIPTION
<span class="m">1</span>               Thu Apr <span class="m">21</span> <span class="m">21</span>:50:57 <span class="m">2022</span>        superseded      examplechart-0.1.0      <span class="m">1</span>.16.0          Install <span class="nb">complete</span>
<span class="m">2</span>               Thu Apr <span class="m">21</span> <span class="m">22</span>:14:53 <span class="m">2022</span>        deployed        examplechart-0.2.0      <span class="m">1</span>.16.0          Upgrade <span class="nb">complete</span>
</pre></div>
</div>
<p>可以看到有两条变更记录，一条为0.1.0版本的Chart，其描述为Install
complete，表示首次安装；</p>
<p>另一条为0.2.0版本的Chart，其描述为Upgrade complete，表示升级的变更记录。</p>
<p>接下来，通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">helm</span> <span class="pre">rollback</span> <span class="pre">{发布名称}</span> <span class="pre">{Revision编号}</span></code>命令，将发布回滚到指定版本。本例中执行的命令如下。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm rollback examplerelease <span class="m">1</span> -n <span class="nb">test</span>
Rollback was a success! Happy Helming!
</pre></div>
</div>
<p>之后再执行<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">helm</span> <span class="pre">list</span></code>命令，可以看到REVISION字段为3，而CHART字段已经变为examplechart-0.1.0，表示已回滚到0.1.0版本</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm <span class="nb">history</span> examplerelease -n <span class="nb">test</span>
REVISION        UPDATED                         STATUS          CHART                   APP VERSION     DESCRIPTION
<span class="m">1</span>               Thu Apr <span class="m">21</span> <span class="m">21</span>:50:57 <span class="m">2022</span>        superseded      examplechart-0.1.0      <span class="m">1</span>.16.0          Install <span class="nb">complete</span>
<span class="m">2</span>               Thu Apr <span class="m">21</span> <span class="m">22</span>:14:53 <span class="m">2022</span>        superseded      examplechart-0.2.0      <span class="m">1</span>.16.0          Upgrade <span class="nb">complete</span>
<span class="m">3</span>               Thu Apr <span class="m">21</span> <span class="m">22</span>:17:46 <span class="m">2022</span>        deployed        examplechart-0.1.0      <span class="m">1</span>.16.0          Rollback to <span class="m">1</span>
</pre></div>
</div>
<p>如果此时再通过$ helm history
examplerelease命令查看变更记录，可以看到末尾多了一条编号为3的记录，其描述为Rollback
to 1，表示已回滚到第一个变更。</p>
<p>如果要删除某个已部署的发布版本，可以执行以下命令。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm delete examplerelease -n <span class="nb">test</span>
</pre></div>
</div>
<p>当再次执行<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">helm</span> <span class="pre">history</span> <span class="pre">examplerelease</span></code>命令查看变更记录时，可以看到查找的发布版本已经不存在。</p>
</section>
</section>
<section id="id10">
<h2><a class="toc-backref" href="#id26">3. 使用Helm部署的项目案例</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p><strong>使用Helm进行部署WordPress</strong></p>
<p>可以执行以下命令，将远程仓库中的stable/wordpress包下载到本地当前目录下并解压出来。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm fetch stable/wordpress --untar
</pre></div>
</div>
<p>可以根据部署环境和要求修改<code class="docutils literal notranslate"><span class="pre">values.yaml</span></code>文件。</p>
<p>使用Helm部署WordPress更加简单，只需要执行以下命令即可。发布版本的名称为wordpress，它会从远程仓库下载名为stable/wordpress的Chart包，并通过–set参数将部署Service类型设置为NodePort。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ helm install wordpress --set <span class="s2">&quot;serviceType=NodePort&quot;</span> stable/wordpress -n <span class="nb">test</span>

WARNING: This chart is deprecated
NAME: wordpress
LAST DEPLOYED: Thu Apr <span class="m">21</span> <span class="m">22</span>:42:38 <span class="m">2022</span>
NAMESPACE: <span class="nb">test</span>
STATUS: deployed
REVISION: <span class="m">1</span>
NOTES:
This Helm chart is deprecated

Given the <span class="sb">`</span>stable<span class="sb">`</span> deprecation timeline <span class="o">(</span>https://github.com/helm/charts#deprecation-timeline<span class="o">)</span>, the Bitnami maintained Helm chart is now located              at bitnami/charts <span class="o">(</span>https://github.com/bitnami/charts/<span class="o">)</span>.

The Bitnami repository is already included <span class="k">in</span> the Hubs and we will <span class="k">continue</span> providing the same cadence of updates, support, etc that we<span class="s1">&#39;ve been              keeping here these years. Installation instructions are very similar, just adding the _bitnami_ repo and using it during the installation (`bitn             ami/&lt;chart&gt;` instead of `stable/&lt;chart&gt;`)</span>

<span class="s1">```bash</span>
<span class="s1">$ helm repo add bitnami https://charts.bitnami.com/bitnami</span>
<span class="s1">$ helm install my-release bitnami/&lt;chart&gt;           # Helm 3</span>
<span class="s1">$ helm install --name my-release bitnami/&lt;chart&gt;    # Helm 2</span>
<span class="s1">```</span>

<span class="s1">To update an exisiting _stable_ deployment with a chart hosted in the bitnami repository you can execute</span>

<span class="s1">```bash</span>
<span class="s1">$ helm repo add bitnami https://charts.bitnami.com/bitnami</span>
<span class="s1">$ helm upgrade my-release bitnami/&lt;chart&gt;</span>
<span class="s1">```</span>

<span class="s1">Issues and PRs related to the chart itself will be redirected to `bitnami/charts` GitHub repository. In the same way, we&#39;</span>ll be happy to answer q             uestions related to this migration process <span class="k">in</span> this issue <span class="o">(</span>https://github.com/helm/charts/issues/20969<span class="o">)</span> created as a common place <span class="k">for</span> discussion.

** Please be patient <span class="k">while</span> the chart is being deployed **

To access your WordPress site from outside the cluster follow the steps below:

<span class="m">1</span>. Get the WordPress URL by running these commands:

  NOTE: It may take a few minutes <span class="k">for</span> the LoadBalancer IP to be available.
        Watch the status with: <span class="s1">&#39;kubectl get svc --namespace test -w wordpress&#39;</span>

   <span class="nb">export</span> <span class="nv">SERVICE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl get svc --namespace <span class="nb">test</span> wordpress --template <span class="s2">&quot;{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}&quot;</span><span class="k">)</span>
   <span class="nb">echo</span> <span class="s2">&quot;WordPress URL: http://</span><span class="nv">$SERVICE_IP</span><span class="s2">/&quot;</span>
   <span class="nb">echo</span> <span class="s2">&quot;WordPress Admin URL: http://</span><span class="nv">$SERVICE_IP</span><span class="s2">/admin&quot;</span>

<span class="m">2</span>. Open a browser and access WordPress using the obtained URL.

<span class="m">3</span>. Login with the following credentials below to see your blog:

  <span class="nb">echo</span> Username: user
  <span class="nb">echo</span> Password: <span class="k">$(</span>kubectl get secret --namespace <span class="nb">test</span> wordpress -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.data.wordpress-password}&quot;</span> <span class="p">|</span> base64 --decode<span class="k">)</span>
</pre></div>
</div>
<p>可以在 RESOURCES
栏看到本次发布涉及的所有与Kubernetes相关的资源（ConfigMap、
PVC、Pod、Secret、Service、Deployment控制器）。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl get pv -n test<span class="p">|</span>grep wordpress
pvc-0a705861-c574-4a3b-8bb9-d2c2003b4768   10Gi       RWO            Retain           Bound    test/wordpress                  mysql-nfs-storage              5m38s
pvc-9d1332ac-b45b-4074-bba9-4945872af874   8Gi        RWO            Retain           Bound    test/data-wordpress-mariadb-0   mysql-nfs-storage              5m38s


$ kubectl get pvc -n test<span class="p">|</span>grep wordpress
data-wordpress-mariadb-0   Bound    pvc-9d1332ac-b45b-4074-bba9-4945872af874   8Gi        RWO            mysql-nfs-storage   4m7s
wordpress                  Bound    pvc-0a705861-c574-4a3b-8bb9-d2c2003b4768   10Gi       RWO            mysql-nfs-storage   4m7s


$ kubectl get deployment -n <span class="nb">test</span>
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
wordpress   <span class="m">1</span>/1     <span class="m">1</span>            <span class="m">1</span>           4m11s


$ kubectl get pod -n <span class="nb">test</span>
NAME                        READY   STATUS    RESTARTS   AGE
wordpress-f9c468c57-bmp4x   <span class="m">1</span>/1     Running   <span class="m">2</span>          5m52s
wordpress-mariadb-0         <span class="m">1</span>/1     Running   <span class="m">0</span>          5m52s

$ kubectl get cm -n <span class="nb">test</span>
NAME                      DATA   AGE
kube-root-ca.crt          <span class="m">1</span>      57m
wordpress-mariadb         <span class="m">1</span>      5m19s
wordpress-mariadb-tests   <span class="m">1</span>      5m19s

$ kubectl get secrets -n <span class="nb">test</span>
NAME                              TYPE                                  DATA   AGE
default-token-wr5kj               kubernetes.io/service-account-token   <span class="m">3</span>      56m
sh.helm.release.v1.wordpress.v1   helm.sh/release.v1                    <span class="m">1</span>      4m25s
wordpress                         Opaque                                <span class="m">1</span>      4m25s
wordpress-mariadb                 Opaque                                <span class="m">2</span>      4m25s

$ kubectl get svc -n <span class="nb">test</span>
NAME                TYPE           CLUSTER-IP     EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                      AGE
wordpress           LoadBalancer   <span class="m">10</span>.106.27.35   &lt;pending&gt;     <span class="m">80</span>:30071/TCP,443:31426/TCP   5m30s
wordpress-mariadb   ClusterIP      <span class="m">10</span>.105.76.76   &lt;none&gt;        <span class="m">3306</span>/TCP                     5m30s
</pre></div>
</div>
<p>若在浏览器中输入http://192.168.1.32:30071/admin，将进入如下图所示页面。此时输入登录账号和密码，单击Log
In按钮。</p>
<img alt="../../_images/image-20220421225032669.png" src="../../_images/image-20220421225032669.png" />
<p>接下来，依次执行之前在NOTES栏提示中给出的命令，获取WordPress的访问地址和登录账号及密码</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> Username: user
Username: user
<span class="nv">$echo</span> Password: <span class="k">$(</span>kubectl get secret --namespace <span class="nb">test</span> wordpress -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.data.wordpress-password}&quot;</span> <span class="p">|</span> base64 --decode<span class="k">)</span>
Password: 6ZaBVU83hX
</pre></div>
</div>
</section>
<section id="id11">
<h2><a class="toc-backref" href="#id27">4. Helm利器的优点</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>Helm可以实现以下功能。</p>
<ul class="simple">
<li><p>将分散而互相关联的应用模板文件作为一个整体统一管理。</p></li>
<li><p>同时发布和重用这些应用模板文件，并进行版本控制。</p></li>
<li><p>统一维护模板文件产生的各种资源（如Pod、Service、PVC等）。</p></li>
</ul>
<blockquote>
<div><p>更多参考文献</p>
<p><a class="reference external" href="https://mp.weixin.qq.com/s/HRFrmvWYDdwjMzHn8sco5w">https://mp.weixin.qq.com/s/HRFrmvWYDdwjMzHn8sco5w</a></p>
<p><a class="reference external" href="https://helm.sh/zh/docs/">https://helm.sh/zh/docs/</a></p>
<p><a class="reference external" href="https://juejin.cn/post/6995347656591540238">https://juejin.cn/post/6995347656591540238</a></p>
</div></blockquote>
</section>
<section id="id12">
<h2><a class="toc-backref" href="#id28">5. 实战 | Helm的使用</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>参考文献</p>
<p><a class="reference external" href="https://mp.weixin.qq.com/s/AUuaZILvXDfqzo558ryHYA">https://mp.weixin.qq.com/s/AUuaZILvXDfqzo558ryHYA</a></p>
</div></blockquote>
<blockquote>
<div><p>玩K8S不得不会的HELM</p>
<p><a class="reference external" href="https://juejin.cn/post/6844904081366974472?share_token=1630eaaf-71c5-4203-8e65-9ff1cbee7570">https://juejin.cn/post/6844904081366974472?share_token=1630eaaf-71c5-4203-8e65-9ff1cbee7570</a></p>
</div></blockquote>
<p>安装 Helm3 管理 Kubernetes 应用</p>
<p><a class="reference external" href="http://www.mydlq.club/article/51/#documentTop">http://www.mydlq.club/article/51/#documentTop</a></p>
<p><a class="reference external" href="https://blog.51cto.com/u_15329153/5223427">https://blog.51cto.com/u_15329153/5223427</a></p>
</section>
<section id="helm3-chart">
<h2><a class="toc-backref" href="#id29">6. Helm3 Chart多依赖微服务构建案例</a><a class="headerlink" href="#helm3-chart" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>参考文献：</p>
<p><a class="reference external" href="https://blog.csdn.net/qq_39680564/article/details/107516510">https://blog.csdn.net/qq_39680564/article/details/107516510</a></p>
</div></blockquote>
</section>
<section id="helmharbor">
<h2><a class="toc-backref" href="#id30">7. Helm部署Harbor</a><a class="headerlink" href="#helmharbor" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>参考文献</p>
</div></blockquote>
<p><a class="reference external" href="https://www.cnblogs.com/sanduzxcvbnm/p/16113462.html">https://www.cnblogs.com/sanduzxcvbnm/p/16113462.html</a></p>
</section>
<section id="helmredis">
<h2><a class="toc-backref" href="#id31">8. Helm部署高可用redis</a><a class="headerlink" href="#helmredis" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>参考文献</p>
<p><a class="reference external" href="https://www.cnblogs.com/keep-live/p/11543789.html">https://www.cnblogs.com/keep-live/p/11543789.html</a></p>
</div></blockquote>
<p>更多参考文献：</p>
<p><a class="reference external" href="https://www.cnblogs.com/davis12/p/15469167.html">https://www.cnblogs.com/davis12/p/15469167.html</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="2.%E6%9C%89%E7%8A%B6%E6%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B.html" class="btn btn-neutral float-left" title="有状态项目的部署案例" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../12.Helm%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/index.html" class="btn btn-neutral float-right" title="12.Helm学习指南" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>