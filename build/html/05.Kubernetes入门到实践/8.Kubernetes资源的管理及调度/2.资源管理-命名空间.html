<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>资源管理-命名空间 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="资源管理-标签、选择器及注解" href="3.%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86-%E6%A0%87%E7%AD%BE%E3%80%81%E9%80%89%E6%8B%A9%E5%99%A8%E5%8F%8A%E6%B3%A8%E8%A7%A3.html" />
    <link rel="prev" title="资源调度-为Pod设置计算资源" href="1.%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6-%E4%B8%BAPod%E8%AE%BE%E7%BD%AE%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> 小健_Docker_K8s_Blog
            <img src="../../_static/docker-k8s.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../01.Docker%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%983%E7%89%88/index.html">01.Docker技术入门与实战3版</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02.Kubernetes%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/index.html">02.Kubernetes实战指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03.Docker%E7%BB%8F%E5%85%B8%E5%AE%9E%E4%BE%8B/index.html">03.Docker经典实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04.Prometheus%E7%9B%91%E6%8E%A7%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/index.html">04.Prometheus监控运维实战</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">05.Kubernetes入门到实践</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../1.%E5%AE%B9%E5%99%A8%E7%9A%84%E5%8F%91%E5%B1%95%E5%8F%B2/index.html">1.容器的发展史</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2.Kubernetes%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/index.html">2.Kubernetes的核心概念</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3.Kubernetes%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2/index.html">3.Kubernetes的安装和部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4.Pod/index.html">4.Pod的基本操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5.%E6%8E%A7%E5%88%B6%E5%99%A8/index.html">5.控制器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6.Service%E5%92%8CIngress/index.html">6.Service和Ingress</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7.%E5%AD%98%E5%82%A8%E4%B8%8E%E9%85%8D%E7%BD%AE/index.html">7.存储与配置</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">8.Kubernetes资源的管理及调度</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="1.%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6-%E4%B8%BAPod%E8%AE%BE%E7%BD%AE%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90.html">资源调度-为Pod设置计算资源</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">资源管理-命名空间</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">1.命名空间的基本操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">2.命名空间中的服务发现</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">3.命名空间的资源配额</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">4.命名空间中单个资源的限额范围</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="3.%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86-%E6%A0%87%E7%AD%BE%E3%80%81%E9%80%89%E6%8B%A9%E5%99%A8%E5%8F%8A%E6%B3%A8%E8%A7%A3.html">资源管理-标签、选择器及注解</a></li>
<li class="toctree-l3"><a class="reference internal" href="4.%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6-Pod%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5%E8%AF%A6%E8%A7%A3.html">资源调度-Pod调度策略详解</a></li>
<li class="toctree-l3"><a class="reference internal" href="5.%E4%BC%98%E5%85%88%E7%BA%A7%E4%B8%8E%E6%8A%A2%E5%8D%A0%E5%BC%8F%E8%B0%83%E5%BA%A6.html">优先级与抢占式调度</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../9.API-Server/index.html">9.API-Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10.Kubernetes%E7%9A%84%E6%89%A9%E5%B1%95/index.html">10.Kubernetes的扩展</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11.%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B/index.html">11.项目部署案例</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">小健_Docker_K8s_Blog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">05.Kubernetes入门到实践</a> &raquo;</li>
          <li><a href="index.html">8.Kubernetes资源的管理及调度</a> &raquo;</li>
      <li>资源管理-命名空间</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/05.Kubernetes入门到实践/8.Kubernetes资源的管理及调度/2.资源管理-命名空间.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id8">资源管理-命名空间</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id9">1.命名空间的基本操作</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id10">2.命名空间中的服务发现</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id11">3.命名空间的资源配额</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id12">4.命名空间中单个资源的限额范围</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id13">4.1 设置容器的限额范围</a></p></li>
<li><p><a class="reference internal" href="#pod" id="id14">4.2 设置Pod的限额范围</a></p></li>
<li><p><a class="reference internal" href="#pvc" id="id15">4.3 设置PVC的限额范围</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id16">4.4 设置Pod或容器的比例限额范围</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="id1">
<h1><a class="toc-backref" href="#id8">资源管理-命名空间</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>命名空间（namespace）的主要作用是对Kubernetes集群资源进行划分，这种划分并非物理划分，而是逻辑划分，用于实现多租户的资源隔离。</p>
<p>如果使用Kubernetes的用户很少，可以不使用命名空间。</p>
<p>但如果使用Kubernetes的团队或用户众多，各种资源管理起来就会比较麻烦。这时就应考虑使用命名空间来进行划分，这样集群内部
的各种资源对象就可以在不同的命名空间下进行管理。</p>
<p>使用命名空间划分资源</p>
<img alt="../../_images/image-20220419135141847.png" src="../../_images/image-20220419135141847.png" />
<section id="id2">
<h2><a class="toc-backref" href="#id9">1.命名空间的基本操作</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>为了创建一个名为examplenamespace的命名空间</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 新建</span>
$ kubectl create namespace examplenamespace

<span class="c1">#删除</span>
$ kubectl delete ns examplenamespace
</pre></div>
</div>
<p>通过模板文件创建命名空间的方式如下。
首先，通过命令创建<code class="docutils literal notranslate"><span class="pre">examplenamespace.yml</span></code>文件。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplenamespace</span>
</pre></div>
</div>
<p>通过模板创建命名空间</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f examplenamespace.yml
</pre></div>
</div>
<p>创建完成后，通过<code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">namespace</span></code>命令可以查看各个命名空间</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl get ns examplenamespace
NAME               STATUS   AGE
examplenamespace   Active   2m7s
</pre></div>
</div>
<p>除了刚刚创建的命名空间外，我们看到查询结果中还有其他几个命名空间，这些都是Kubernetes的初始命名空间。</p>
<ul class="simple">
<li><p>default：所有未指定namespace属性的对象都会分配到default命名空间中。</p></li>
<li><p>kube-node-lease：主要存放各个节点上的Lease对象，用于节点的心跳检测。</p></li>
<li><p>kube-system：所有由Kubernetes系统创建的资源都在这个命名空间中。</p></li>
<li><p>kube-public：此命名空间下的资源可以被所有人访问（包括未认证用户）</p></li>
</ul>
<p>此时可以在刚才创建的examplenamespace命名空间下创建资源。为了创建一个Pod，首先，使用以下命令创建模板文件。</p>
<p><code class="docutils literal notranslate"><span class="pre">examplepodforns.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplepodforns</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplenamespace</span>

<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplepod-container</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">busybox</span>
    <span class="nt">imagePullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;sh&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;-c&#39;</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;echo</span><span class="nv"> </span><span class="s">&quot;Hello</span><span class="nv"> </span><span class="s">Kubernetes!&quot;;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">3600&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>该模板和之前的示例几乎相同，唯一的区别在于，指定了namespace属性，它指向刚刚创建的examplenamespace命名空间。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f examplepodforns.yml
</pre></div>
</div>
<p>对于某个命名空间下的资源，所有命令（如get、describe、logs、delete等）都必须带上<strong>–namespace={命名空间}或-n
{命名空间}参数</strong>，才能够查询。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl get pod -n examplenamespace
NAME              READY   STATUS    RESTARTS   AGE
examplepodforns   <span class="m">1</span>/1     Running   <span class="m">0</span>          0s
</pre></div>
</div>
<p>大多数Kubernetes资源（例如，Pod、Service、控制器等）在命名空间中，但是命名空间资源本身并不在命名空间中，并且低级资源（例如，节点和持久存储卷等）也不在任何命名空间中。</p>
<p>可以使用命令查看哪些Kubernetes资源在命名空间中，哪些不在。
通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">api-resources</span> <span class="pre">--namespaced=true</span></code>命令，可以查看位于命名空间下的资源</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl api-resources --namespaced<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<img alt="../../_images/image-20220419140153021.png" src="../../_images/image-20220419140153021.png" />
<p>通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">api-resources</span> <span class="pre">--namespaced=false</span></code>命令，可以查看不在命名空间下的资源</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl api-resources --namespaced<span class="o">=</span><span class="nb">false</span>
</pre></div>
</div>
<img alt="../../_images/image-20220419140301998.png" src="../../_images/image-20220419140301998.png" />
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id10">2.命名空间中的服务发现</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>命名空间和Service的DNS也有一定关系，之前章节提及过DNS服务发现的方式，其具体访问格式为</p>
<p><strong>{ServiceName}.{Namespace}.svc.{ClusterDomain}。</strong></p>
<p>之前的示例中因为没有使用命名空间，所以{Namespace}填写的都是default。</p>
<p>如果某个Service资源位于某个命名空间下（如刚才创建的examplenamespace命名空间），DNS将会变为</p>
<p><strong>{ServiceName}.examplenamespace.svc.{ClusterDomain}。</strong></p>
<p>通过以下命令，可以查询命名空间的详情。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl describe namespace examplenamespace
Name:         examplenamespace
Labels:       kubernetes.io/metadata.name<span class="o">=</span>examplenamespace
Annotations:  &lt;none&gt;
Status:       Active

No resource quota.

No LimitRange resource.
</pre></div>
</div>
<p>使用<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">namespace</span> <span class="pre">examplenamespace</span></code>命令可以看到“No
resource quota”（没有资源配额）和“No resource limits”（没有资源限额）</p>
<p>对于某个命名空间，可以分别设置其资源配额（ResourceQuota）和限额范围（LimitRange）</p>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id11">3.命名空间的资源配额</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>命名空间的设计初衷是实现多租户的资源隔离。</p>
<p>这只是逻辑隔离，实际上所有租户都共用同一个Kubernetes集群，所以还需要规划命名空间的资源配额（ResourceQuota），以免某个命名空间滥用集群资源而影响整个Kubernetes集群。</p>
<p>可以通过ResourceQuota来定义资源配额，设置命名空间下能够使用的各类资源总量。</p>
<p>一个命名空间下最多只能存在一个ResourceQuota。</p>
<p>资源配额分为3种类型。</p>
<ul class="simple">
<li><p>计算资源配额：指定可用的计算机资源总量（如总内存或CPU等）。</p></li>
<li><p>存储资源配额：指定可用的存储资源总量（如PVC总数等）。</p></li>
<li><p>对象数量配额：指定Kubernetes资源对象的可用总量（如Pod总数和Service总数等）。</p></li>
</ul>
<p>资源配额模板的定义如下所示。</p>
<p><code class="docutils literal notranslate"><span class="pre">template.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ResourceQuota</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span> <span class="c1">#资源配额名称</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span> <span class="c1">#所属命名空间</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">hard</span><span class="p">:</span>
    <span class="c1">#计算资源配额</span>
    <span class="nt">limits.cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#对于所有非终止状态的Pod，其CPU限额总量不能超过该值</span>
    <span class="nt">limits.memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#对于所有非终止状态的Pod，其内存限额总量不能超过该值</span>
    <span class="nt">requests.cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#对于所有非终止状态的Pod，其CPU需求总量不能超过该值</span>
    <span class="nt">requests.memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#对于所有非终止状态的Pod，其内存需求总量不能超过该值</span>
    <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#等同于requests.cpu</span>
    <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#等同于requests.memory</span>
    <span class="c1">#存储资源配额</span>
    <span class="nt">requests.storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#在所有的PVC中，存储资源的需求不能超过该值</span>
    <span class="nt">persistentvolumeclaims</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的PVC数量</span>
    <span class="p p-Indicator">{</span><span class="nv">storage-class-name</span><span class="p p-Indicator">}</span><span class="nt">.storageclass.storage.k8s.io/requests.storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#在所有与该storage-class-name相关的PVC中，存储资源的需求不能超过该值</span>
    <span class="p p-Indicator">{</span><span class="nv">storage-class-name</span><span class="p p-Indicator">}</span><span class="nt">.storageclass.storage.k8s.io/persistentvolumeclaims</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许与该storage-class-name相关的PVC总量 对象数量配额</span>
    <span class="nt">configmaps</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的ConfigMap数量</span>
    <span class="nt">pods</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的非终止状态的Pod数量。如果Pod的status.phase为Failed或Succeeded那么它处于终止状态</span>
    <span class="nt">replicationcontrollers</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的ReplicationController数量</span>
    <span class="nt">resourcequotas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的资源配额数量</span>
    <span class="nt">services</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的Service数量</span>
    <span class="nt">services.loadbalancers</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的LoadBalancer类型的Service数量</span>
    <span class="nt">services.nodeports</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的NodePort类型的Service数量</span>
    <span class="nt">secrets</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span> <span class="c1">#允许存在的Secret数量</span>
</pre></div>
</div>
<p>为了给命名空间创建一个简单的资源配额，首先，通过命令创建模板文件。</p>
<p><code class="docutils literal notranslate"><span class="pre">exampleresourcequota.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ResourceQuota</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">exampleresourcequota</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplenamespace</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">hard</span><span class="p">:</span>
    <span class="nt">pods</span><span class="p">:</span> <span class="s">&quot;2&quot;</span>
    <span class="nt">services</span><span class="p">:</span> <span class="s">&quot;1&quot;</span>
    <span class="nt">persistentvolumeclaims</span><span class="p">:</span> <span class="s">&quot;4&quot;</span>
</pre></div>
</div>
<p>接下来，运行以下命令，通过模板创建资源配额。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f exampleresourcequota.yml
</pre></div>
</div>
<p>创建完成后，通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">resourcequota</span> <span class="pre">-n</span> <span class="pre">examplenamespace</span></code>命令可以查看刚刚创建的资源配额。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl get resourcequota -n examplenamespace
NAME                   AGE    REQUEST                                                 LIMIT
exampleresourcequota   100s   persistentvolumeclaims: <span class="m">0</span>/4, pods: <span class="m">1</span>/2, services: <span class="m">0</span>/1
</pre></div>
</div>
<p>接下来，通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">resourcequota</span> <span class="pre">exampleresourcequota</span> <span class="pre">-n</span> <span class="pre">examplenamespace</span></code>命令可以查看具体的资源占用
情况,因为之前已经在examplenamespace命名空间中创建了1个Pod，所以pods的Used属性为1。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl describe resourcequota exampleresourcequota -n examplenamespace
Name:                   exampleresourcequota
Namespace:              examplenamespace
Resource                Used  Hard
--------                ----  ----
persistentvolumeclaims  <span class="m">0</span>     <span class="m">4</span>
pods                    <span class="m">1</span>     <span class="m">2</span>
services                <span class="m">0</span>     <span class="m">1</span>
</pre></div>
</div>
<p>如果此时再通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">namespace</span> <span class="pre">examplenamespace</span></code>命令查看命名空间的详细信息，可以看到原先的No
resource quota提示已经变成具体的配额，和刚刚我们配置的一模一样</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl describe namespace examplenamespace
Name:         examplenamespace
Labels:       kubernetes.io/metadata.name<span class="o">=</span>examplenamespace
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
  Name:                   exampleresourcequota
  Resource                Used  Hard
  --------                ---   ---
  persistentvolumeclaims  <span class="m">0</span>     <span class="m">4</span>
  pods                    <span class="m">1</span>     <span class="m">2</span>
  services                <span class="m">0</span>     <span class="m">1</span>

No LimitRange resource.
</pre></div>
</div>
<p>此时可以尝试在该命名空间下继续创建Pod。目前Pod的使用量为1，上限为2。接下来，创建一个Deployment控制器并将其副本数设置为2，这样刚好超过上限，多出1个Pod，试试看会发生什么情况。为此，首先，通过命令创建模板文件。</p>
<p><code class="docutils literal notranslate"><span class="pre">exampledeploymentforns.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">exampledeploymentforns</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplenamespace</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">example</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deploymentforns</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">example</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deploymentforns</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.7.9</span>
        <span class="nt">imagePullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
        <span class="nt">ports</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div>
</div>
<p>这里的Deployment示例除了指定命名空间为examplenamespace外，和之前的示例没有什么区别，其副本数设置为2。</p>
<p>通过模板创建Deployment控制器。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f exampledeploymentforns.yaml
</pre></div>
</div>
<p>创建完成后，分别查看Pod创建情况，可以看到Deployment控制器只创建了一个Pod，另一个Pod无法创建，</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl get pod -n examplenamespace
$ kubectl get deploy -n examplenamespace
$ kubectl describe deploy -n examplenamespace exampledeploymentforns
</pre></div>
</div>
<p>输出Deployment控制器详情。在输出文本的下半部分可以找到失败的原因是请求的Pod数超出了配额限制</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl get deploy exampledeploymentforns -n examplenamespace -o yaml
</pre></div>
</div>
<img alt="../../_images/image-20220419141942743.png" src="../../_images/image-20220419141942743.png" />
<p>此时如果将Deployment控制器的副本数量设置为1，或者删除旧的Pod，或者更改配额设置为更大的数值，则另一个Pod才会成功创建。</p>
<blockquote>
<div><p>注意：如果在ResourceQuota中设置了任何一种计算机资源配额（cpu、limits.cpu、requests.cpu、memory、limits.memory和
requests.memory属性），那么在创建Pod或控制器时，在Pod模板中也必须明确指定相关的计算机资源属性值（即容器的resources.limits.cpu、resources.limits.memory、resources.requests.cpu、resources.requests.memory属性），或者已经通过LimitRange对象设置默认值；否则，将无法创建，并在创建时将会出现图8-19所示的错误消息。另外，在使用kubectl
describe
resourcequota命令查询时，计算机资源配额的Used属性其实并非CPU或内存的实时使用值之和，而是在Pod模板中填写的指定值之和。</p>
</div></blockquote>
<img alt="../../_images/image-20220419142214363.png" src="../../_images/image-20220419142214363.png" />
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id12">4.命名空间中单个资源的限额范围</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>通过设置资源配额，可以限定一个命名空间下使用的资源总量。但这仅是总量设置，对于单个资源没有限制，很有可能单个
Pod 或容器就会消耗完整个命名空间下资源配额所指定的CPU
或内存总量。为了避免单个资源对象消耗所有的命名空间资源，可以通过LimitRange对象来对单个资源对象的资源占用量进行限定。</p>
<p>通过LimitRange对象可以实现以下功能。</p>
<ul class="simple">
<li><p>设置命名空间下单个Pod或容器的最小和最大计算资源使用量。</p></li>
<li><p>设置命名空间下单个PVC的最小和最大存储请求。</p></li>
<li><p>设置命名空间下请求（request）资源量和上限（limit）资源量的比例。</p></li>
<li><p>设置命名空间下默认的计算资源请求与上限，并在运行时自动将其注入容器中。</p></li>
</ul>
<p><strong>如果在命名空间下对CPU或内存设置了请求与上限，那么在定义Pod资源时，必须明确在模板中指定这两个值否则，系统会拒绝创建Pod（除非在定义LimitRange
时设置了默认值）。如果在设置LimitRange之前就创建了Pod，</strong>
<strong>即使之后设置了LimitRange，那么对正在运行的Pod也没有影响，除非Pod重建。</strong></p>
<p><strong>如果在命名空间下设置了PVC请求的存储大小，那么当定义PVC时如果请求的大小不在范围内，系统也会拒绝创建PVC。</strong></p>
<section id="id6">
<h3><a class="toc-backref" href="#id13">4.1 设置容器的限额范围</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>通过设置type为Container的限额范围，可以定义每个容器中最小与最大的内存/CPU限制，以及默认的内存/CPU请求及限制。首先，通过命令创建<code class="docutils literal notranslate"><span class="pre">limitrangeforcontainer.yml</span></code>文件。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LimitRange</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">limitrangeforcontainer</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplenamespace</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">limits</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">max</span><span class="p">:</span>
      <span class="nt">cpu</span><span class="p">:</span> <span class="s">&quot;200m&quot;</span>
      <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;300Mi&quot;</span>
    <span class="nt">min</span><span class="p">:</span>
      <span class="nt">cpu</span><span class="p">:</span> <span class="s">&quot;100m&quot;</span>
      <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;150Mi&quot;</span>
    <span class="nt">default</span><span class="p">:</span>
      <span class="nt">cpu</span><span class="p">:</span> <span class="s">&quot;180m&quot;</span>
      <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;250Mi&quot;</span>
    <span class="nt">defaultRequest</span><span class="p">:</span>
      <span class="nt">cpu</span><span class="p">:</span> <span class="s">&quot;110m&quot;</span>
      <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;160Mi&quot;</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Container</span>
</pre></div>
</div>
<p>接下来，运行以下命令，通过模板创建限额范围。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f limitrangeforcontainer.yml
</pre></div>
</div>
<p>创建完成后，可以通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">limitrange</span> <span class="pre">-n</span> <span class="pre">examplenamespace</span></code>命令查看限额范围</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl get limitrange  -n examplenamespace
NAME                     CREATED AT
limitrangeforcontainer   <span class="m">2022</span>-04-19T06:52:29Z
</pre></div>
</div>
<p>也可以通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">limitrange</span> <span class="pre">limitrangeforcontainer</span> <span class="pre">-n</span> <span class="pre">examplenamespace</span></code>命令查看限额范围的详情，</p>
<p>可以看到LimitRange创建后关于容器的计算资源限额范围的详情。</p>
<img alt="../../_images/image-20220419145530035.png" src="../../_images/image-20220419145530035.png" />
<p>从图中可以看到容器CPU及内存的Min和Max属性，这表示最小资源限制与最大资源限制。LimitRange生效之后，当创建Pod模板或填写控制器的Pod模板时，各个容器的resources.limits和resources.requests属性必须要满足指定Min/Max条件的资源限制，否则无法成功创建。本例中必须满足的条件如下所示。</p>
<ul class="simple">
<li><p>100m≤容器的resources.requests.cpu≤容器的resources.limits.cpu≤200m</p></li>
<li><p>150MiB≤容器的resources.requests.memory≤容器的resources.limits.
memory≤300MiB</p></li>
</ul>
<p>defaultRequest属性和defaultLimit属性分别代表默认请求值和默认限制值。在创建Pod模板或填写控制器的Pod模板时，如果没有显式指定resources.limits和resources.requests属性，则在创建时会自动将其填充为LimitRange中的默认值。</p>
<p>在本例中默认值如下所示。</p>
<ul class="simple">
<li><p>容器默认resources.limits.cpu = 180m。</p></li>
<li><p>容器默认resources.limits.memory = 250Mi。</p></li>
<li><p>容器默认resources.requests.cpu = 110m。</p></li>
<li><p>容器默认resources.requests.memory = 160Mi。</p></li>
</ul>
</section>
<section id="pod">
<h3><a class="toc-backref" href="#id14">4.2 设置Pod的限额范围</a><a class="headerlink" href="#pod" title="Permalink to this headline">¶</a></h3>
<p>可以设置type为Pod的限额范围，定义Pod中全部容器的内存/CPU限额总和的最小值以及最大值。首先，通过命令创建<code class="docutils literal notranslate"><span class="pre">limitrangeforpod.yml</span></code>文件。</p>
<p><code class="docutils literal notranslate"><span class="pre">limitrangeforpod.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LimitRange</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">limitrangeforpod</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplenamespace</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">limits</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">max</span><span class="p">:</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="s">&quot;1&quot;</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;600Mi&quot;</span>
      <span class="nt">min</span><span class="p">:</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="s">&quot;100m&quot;</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;150Mi&quot;</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
</pre></div>
</div>
<p>运行以下命令，通过模板创建限额范围。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f limitrangeforpod.yml
</pre></div>
</div>
<p>接下来，通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">limitrange</span> <span class="pre">limitrangeforpod</span> <span class="pre">-</span> <span class="pre">n</span> <span class="pre">examplenamespace</span></code>命令查看限额范围的详情</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl describe limitrange limitrangeforpod -n examplenamespace
Name:       limitrangeforpod
Namespace:  examplenamespace
Type        Resource  Min    Max    Default Request  Default Limit  Max Limit/Request Ratio
----        --------  ---    ---    ---------------  -------------  -----------------------
Pod         cpu       100m   <span class="m">1</span>      -                -              -
Pod         memory    150Mi  600Mi  -                -              -
</pre></div>
</div>
<p>可以看到Pod的CPU及内存的Min和Max属性，这表示Pod最小与最大资源限制。LimitRange生效之后，当再次创建Pod模板或填写控制器的Pod模板时，必须使各个容器的resources.limits属性总和满足资源限制，否则无法成功创建。本例中必须满足的条件如下所示。</p>
<ul class="simple">
<li><p>100m≤Pod模板中所有容器的resources.limits.cpu总和≤1</p></li>
<li><p>150MiB≤Pod模板中所有容器的resources.limits.memory总和≤600MiB</p></li>
</ul>
</section>
<section id="pvc">
<h3><a class="toc-backref" href="#id15">4.3 设置PVC的限额范围</a><a class="headerlink" href="#pvc" title="Permalink to this headline">¶</a></h3>
<p>可以设置type为PersistentVolumeClaim的限额范围，定义PVC的最小与最大存储量。首先，通过命令创建<code class="docutils literal notranslate"><span class="pre">limitrangeforpvc.yml</span></code>文件。</p>
<p><code class="docutils literal notranslate"><span class="pre">limitrangeforpvc.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LimitRange</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">limitrangeforpvc</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplenamespace</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">limits</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
    <span class="nt">max</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
    <span class="nt">min</span><span class="p">:</span>
      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200Mi</span>
</pre></div>
</div>
<p>运行以下命令，通过模板创建限额范围。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f limitrangeforpvc.yml
</pre></div>
</div>
<p>接下来，通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">limitrange</span> <span class="pre">limitrangeforpvc</span> <span class="pre">-n</span> <span class="pre">examplenamespace</span></code>命令查看限额范围的详情。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl describe limitrange limitrangeforpvc -n examplenamespace
Name:                  limitrangeforpvc
Namespace:             examplenamespace
Type                   Resource  Min    Max  Default Request  Default Limit  Max Limit/Request Ratio
----                   --------  ---    ---  ---------------  -------------  -----------------------
PersistentVolumeClaim  storage   200Mi  1Gi  -                -              -
</pre></div>
</div>
<p>可以看到PVC存储资源的Min和Max属性。LimitRange生效之后，当再次创建PVC模板或填写StatefulSet的存储卷申请模板（volumeClaimTemplate）时，必须使PVC的resources.requests.storage属性满足资源限额范围，否则无法成功创建。</p>
<p>本例中必须满足的条件如下所示。</p>
<ul class="simple">
<li><p>200MiB≤PVC模板中的resources.requests.storage属性≤1GiB</p></li>
</ul>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id16">4.4 设置Pod或容器的比例限额范围</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>可以对Pod或容器设置请求资源量和上限资源量的比值。对于Pod来说，这是Pod模板中所有容器的resources.limits.cpu或memory的总和与所有容器的resources.
requests.cpu或memory的总和之比；</p>
<p>而对于容器来说，这是单个容器的resources.
limits.cpu或memory与自身的resources.requests.cpu或memory之比。</p>
<p>这里我们以Pod中的memory限额范围为例进行介绍。</p>
<p><code class="docutils literal notranslate"><span class="pre">limitrangeforratiopod.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LimitRange</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">limitrangeforratiopod</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">examplenamespace</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">limits</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">maxLimitRequestRatio</span><span class="p">:</span>
      <span class="nt">memory</span><span class="p">:</span> <span class="s">&quot;2&quot;</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pod</span>
</pre></div>
</div>
<p>运行以下命令，通过模板创建限额范围。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f limitrangeforratiopod.yml
</pre></div>
</div>
<p>接下来，通过<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">limitrange</span> <span class="pre">limitrangeforratiopod</span> <span class="pre">-n</span> <span class="pre">examplenamespace</span></code>命令查看限额范围的详情。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl describe limitrange limitrangeforratiopod -n examplenamespace
Name:       limitrangeforratiopod
Namespace:  examplenamespace
Type        Resource  Min  Max  Default Request  Default Limit  Max Limit/Request Ratio
----        --------  ---  ---  ---------------  -------------  -----------------------
Pod         memory    -    -    -                -              <span class="m">2</span>
</pre></div>
</div>
<p>可以看到LimitRange创建后关于Pod存储资源限额范围的详情。</p>
<p>可以看到Pod内存资源的Max Limit/Request
Ratio属性。LimitRange生效之后，当再次创建Pod模板或填写控制器的Pod模板时，必须使Pod的resources.requests属性和resources.limit属性满足比例限制，否则无法成功创建。</p>
<p>本例中必须满足的条件如下所示。</p>
<ul class="simple">
<li><p>Pod 模板中所有容器的resources.limits.memory总和 =
Pod模板中所有容器的resources.requests.memory总和 × 2</p></li>
</ul>
<p>可以通过查看命名空间的详情统一查看创建的多个限额范围。本例中的具体命令为<code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">namespace</span> <span class="pre">examplenamespace。</span></code>可以看到原先的“No
resource limits”提示已经变成具体的限额范围，这和刚刚我们配置的一模一样，</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl describe namespace examplenamespace
Name:         examplenamespace
Labels:       kubernetes.io/metadata.name<span class="o">=</span>examplenamespace
Annotations:  &lt;none&gt;
Status:       Active

Resource Quotas
  Name:                   exampleresourcequota
  Resource                Used  Hard
  --------                ---   ---
  persistentvolumeclaims  <span class="m">0</span>     <span class="m">4</span>
  pods                    <span class="m">2</span>     <span class="m">2</span>
  services                <span class="m">0</span>     <span class="m">1</span>

Resource Limits
 Type                   Resource  Min    Max    Default Request  Default Limit  Max Limit/Request Ratio
 ----                   --------  ---    ---    ---------------  -------------  -----------------------
 Container              memory    150Mi  300Mi  160Mi            250Mi          -
 Container              cpu       100m   200m   110m             180m           -
 Pod                    memory    150Mi  600Mi  -                -              -
 Pod                    cpu       100m   <span class="m">1</span>      -                -              -
 PersistentVolumeClaim  storage   200Mi  1Gi    -                -              -
 Pod                    memory    -      -      -                -              <span class="m">2</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="1.%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6-%E4%B8%BAPod%E8%AE%BE%E7%BD%AE%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90.html" class="btn btn-neutral float-left" title="资源调度-为Pod设置计算资源" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3.%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86-%E6%A0%87%E7%AD%BE%E3%80%81%E9%80%89%E6%8B%A9%E5%99%A8%E5%8F%8A%E6%B3%A8%E8%A7%A3.html" class="btn btn-neutral float-right" title="资源管理-标签、选择器及注解" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>