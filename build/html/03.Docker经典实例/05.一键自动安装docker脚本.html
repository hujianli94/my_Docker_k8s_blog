<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>一键自动安装docker脚本 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="使用Supervisor运行WordPress" href="06.%E4%BD%BF%E7%94%A8Supervisor%E8%BF%90%E8%A1%8CWordPress.html" />
    <link rel="prev" title="DockerFile企业案例四" href="04.DockerFile%E4%BC%81%E4%B8%9A%E6%A1%88%E4%BE%8B%E5%9B%9B.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> 小健_Docker_K8s_Blog
            <img src="../_static/docker-k8s.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01.Docker%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%983%E7%89%88/index.html">01.Docker技术入门与实战3版</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.Kubernetes%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/index.html">02.Kubernetes实战指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">03.Docker经典实例</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01.DockerFile%E4%BC%81%E4%B8%9A%E6%A1%88%E4%BE%8B%E4%B8%80.html">DockerFile企业案例一</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.Dockerfike%E4%BC%81%E4%B8%9A%E6%A1%88%E4%BE%8B%E4%BA%8C.html">Dockerfile企业案例二</a></li>
<li class="toctree-l2"><a class="reference internal" href="03.Dockerfile%E4%BC%81%E4%B8%9A%E6%A1%88%E4%BE%8B%E4%B8%89.html">Dockerfile企业案例三</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.DockerFile%E4%BC%81%E4%B8%9A%E6%A1%88%E4%BE%8B%E5%9B%9B.html">DockerFile企业案例四</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">一键自动安装docker脚本</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.%E4%BD%BF%E7%94%A8Supervisor%E8%BF%90%E8%A1%8CWordPress.html">使用Supervisor运行WordPress</a></li>
<li class="toctree-l2"><a class="reference internal" href="07.%E5%9C%A8Docker%E4%B8%AD%E8%BF%90%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC.html">在Docker中运行自定义脚本</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.%E5%88%9B%E5%BB%BASSH%E6%9C%8D%E5%8A%A1%E9%95%9C%E5%83%8F.html">创建SSH服务镜像</a></li>
<li class="toctree-l2"><a class="reference internal" href="09.Docker%E9%83%A8%E7%BD%B2Apache%2BPHP%2BMariaDB%2BphpMyAdmin.html">Docker部署Apache+PHP+MariaDB+phpMyAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="10.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B.html">实战案例</a></li>
<li class="toctree-l2"><a class="reference internal" href="11.%E7%94%A8Docker%E6%9D%A5%E6%90%AD%E5%BB%BAdiscuz%E8%AE%BA%E5%9D%9B.html">用Docker来搭建discuz论坛</a></li>
<li class="toctree-l2"><a class="reference internal" href="12.Docker%E9%83%A8%E7%BD%B2LNMP%E7%8E%AF%E5%A2%83.html">Docker部署LNMP环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="13.%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E4%B8%80%E9%94%AELNMP%E5%AE%89%E8%A3%85%E7%A8%8B%E5%BA%8F.html">基于Docker的一键LNMP安装程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="14.Docker%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2Jenkins-CICD%E7%8E%AF%E5%A2%83.html">Docker快速部署Jenkins CICD环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="15.%E9%83%A8%E7%BD%B2Docker-Harbor%E4%BB%93%E5%BA%93.html">部署Docker-Harbor仓库</a></li>
<li class="toctree-l2"><a class="reference internal" href="16.%E5%9F%BA%E4%BA%8EDocker%E6%90%AD%E5%BB%BAprometheus%2BGrafana.html">基于Docker搭建prometheus+Grafana</a></li>
<li class="toctree-l2"><a class="reference internal" href="17.consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C.html">consul服务注册</a></li>
<li class="toctree-l2"><a class="reference internal" href="18.Docker%E5%AE%8C%E7%BE%8E%E9%83%A8%E7%BD%B2Gitea.html">Docker完美部署Gitea</a></li>
<li class="toctree-l2"><a class="reference internal" href="19.%E4%BD%BF%E7%94%A8CoreDNS%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%BF%83%E5%86%85%E7%BD%91DNS.html">使用CoreDNS作为数据中心内网DNS</a></li>
<li class="toctree-l2"><a class="reference internal" href="20.%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Harborv2.html">离线安装Harbor v2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../04.Prometheus%E7%9B%91%E6%8E%A7%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/index.html">04.Prometheus监控运维实战</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.Kubernetes%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/index.html">05.Kubernetes入门到实践</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">小健_Docker_K8s_Blog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">03.Docker经典实例</a> &raquo;</li>
      <li>一键自动安装docker脚本</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/03.Docker经典实例/05.一键自动安装docker脚本.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#docker" id="id1">一键自动安装docker脚本</a></p></li>
</ul>
</div>
<section id="docker">
<h1><a class="toc-backref" href="#id1">一键自动安装docker脚本</a><a class="headerlink" href="#docker" title="Permalink to this heading">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/sh
set -e

# This script is meant for quick &amp; easy install via:
#   $ curl -fsSL https://get.docker.com -o get-docker.sh
#   $ sh get-docker.sh
#
# For test builds (ie. release candidates):
#   $ curl -fsSL https://test.docker.com -o test-docker.sh
#   $ sh test-docker.sh
#
# NOTE: Make sure to verify the contents of the script
#       you downloaded matches the contents of install.sh
#       located at https://github.com/docker/docker-install
#       before executing.
#
# Git commit from https://github.com/docker/docker-install when
# the script was uploaded (Should only be modified by upload job):
SCRIPT_COMMIT_SHA=2f4ae48


# The channel to install from:
#   * nightly
#   * test
#   * stable
#   * edge (deprecated)
DEFAULT_CHANNEL_VALUE=&quot;stable&quot;
if [ -z &quot;$CHANNEL&quot; ]; then
    CHANNEL=$DEFAULT_CHANNEL_VALUE
fi

DEFAULT_DOWNLOAD_URL=&quot;https://download.docker.com&quot;
if [ -z &quot;$DOWNLOAD_URL&quot; ]; then
    DOWNLOAD_URL=$DEFAULT_DOWNLOAD_URL
fi

DEFAULT_REPO_FILE=&quot;docker-ce.repo&quot;
if [ -z &quot;$REPO_FILE&quot; ]; then
    REPO_FILE=&quot;$DEFAULT_REPO_FILE&quot;
fi

mirror=&#39;&#39;
DRY_RUN=${DRY_RUN:-}
while [ $# -gt 0 ]; do
    case &quot;$1&quot; in
        --mirror)
            mirror=&quot;$2&quot;
            shift
            ;;
        --dry-run)
            DRY_RUN=1
            ;;
        --*)
            echo &quot;Illegal option $1&quot;
            ;;
    esac
    shift $(( $# &gt; 0 ? 1 : 0 ))
done

case &quot;$mirror&quot; in
    Aliyun)
        DOWNLOAD_URL=&quot;https://mirrors.aliyun.com/docker-ce&quot;
        ;;
    AzureChinaCloud)
        DOWNLOAD_URL=&quot;https://mirror.azure.cn/docker-ce&quot;
        ;;
esac

command_exists() {
    command -v &quot;$@&quot; &gt; /dev/null 2&gt;&amp;1
}

is_dry_run() {
    if [ -z &quot;$DRY_RUN&quot; ]; then
        return 1
    else
        return 0
    fi
}

deprecation_notice() {
    distro=$1
    date=$2
    echo
    echo &quot;DEPRECATION WARNING:&quot;
    echo &quot;    The distribution, $distro, will no longer be supported in this script as of $date.&quot;
    echo &quot;    If you feel this is a mistake please submit an issue at https://github.com/docker/docker-install/issues/new&quot;
    echo
    sleep 10
}

get_distribution() {
    lsb_dist=&quot;&quot;
    # Every system that we officially support has /etc/os-release
    if [ -r /etc/os-release ]; then
        lsb_dist=&quot;$(. /etc/os-release &amp;&amp; echo &quot;$ID&quot;)&quot;
    fi
    # Returning an empty string here should be alright since the
    # case statements don&#39;t act unless you provide an actual value
    echo &quot;$lsb_dist&quot;
}

add_debian_backport_repo() {
    debian_version=&quot;$1&quot;
    backports=&quot;deb http://ftp.debian.org/debian $debian_version-backports main&quot;
    if ! grep -Fxq &quot;$backports&quot; /etc/apt/sources.list; then
        (set -x; $sh_c &quot;echo \&quot;$backports\&quot; &gt;&gt; /etc/apt/sources.list&quot;)
    fi
}

echo_docker_as_nonroot() {
    if is_dry_run; then
        return
    fi
    if command_exists docker &amp;&amp; [ -e /var/run/docker.sock ]; then
        (
            set -x
            $sh_c &#39;docker version&#39;
        ) || true
    fi
    your_user=your-user
    [ &quot;$user&quot; != &#39;root&#39; ] &amp;&amp; your_user=&quot;$user&quot;
    # intentionally mixed spaces and tabs here -- tabs are stripped by &quot;&lt;&lt;-EOF&quot;, spaces are kept in the output
    echo &quot;If you would like to use Docker as a non-root user, you should now consider&quot;
    echo &quot;adding your user to the \&quot;docker\&quot; group with something like:&quot;
    echo
    echo &quot;  sudo usermod -aG docker $your_user&quot;
    echo
    echo &quot;Remember that you will have to log out and back in for this to take effect!&quot;
    echo
    echo &quot;WARNING: Adding a user to the \&quot;docker\&quot; group will grant the ability to run&quot;
    echo &quot;         containers which can be used to obtain root privileges on the&quot;
    echo &quot;         docker host.&quot;
    echo &quot;         Refer to https://docs.docker.com/engine/security/security/#docker-daemon-attack-surface&quot;
    echo &quot;         for more information.&quot;

}

# Check if this is a forked Linux distro
check_forked() {

    # Check for lsb_release command existence, it usually exists in forked distros
    if command_exists lsb_release; then
        # Check if the `-u` option is supported
        set +e
        lsb_release -a -u &gt; /dev/null 2&gt;&amp;1
        lsb_release_exit_code=$?
        set -e

        # Check if the command has exited successfully, it means we&#39;re in a forked distro
        if [ &quot;$lsb_release_exit_code&quot; = &quot;0&quot; ]; then
            # Print info about current distro
            cat &lt;&lt;-EOF
            You&#39;re using &#39;$lsb_dist&#39; version &#39;$dist_version&#39;.
            EOF

            # Get the upstream release info
            lsb_dist=$(lsb_release -a -u 2&gt;&amp;1 | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39; | grep -E &#39;id&#39; | cut -d &#39;:&#39; -f 2 | tr -d &#39;[:space:]&#39;)
            dist_version=$(lsb_release -a -u 2&gt;&amp;1 | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39; | grep -E &#39;codename&#39; | cut -d &#39;:&#39; -f 2 | tr -d &#39;[:space:]&#39;)

            # Print info about upstream distro
            cat &lt;&lt;-EOF
            Upstream release is &#39;$lsb_dist&#39; version &#39;$dist_version&#39;.
            EOF
        else
            if [ -r /etc/debian_version ] &amp;&amp; [ &quot;$lsb_dist&quot; != &quot;ubuntu&quot; ] &amp;&amp; [ &quot;$lsb_dist&quot; != &quot;raspbian&quot; ]; then
                if [ &quot;$lsb_dist&quot; = &quot;osmc&quot; ]; then
                    # OSMC runs Raspbian
                    lsb_dist=raspbian
                else
                    # We&#39;re Debian and don&#39;t even know it!
                    lsb_dist=debian
                fi
                dist_version=&quot;$(sed &#39;s/\/.*//&#39; /etc/debian_version | sed &#39;s/\..*//&#39;)&quot;
                case &quot;$dist_version&quot; in
                    9)
                        dist_version=&quot;stretch&quot;
                    ;;
                    8|&#39;Kali Linux 2&#39;)
                        dist_version=&quot;jessie&quot;
                    ;;
                esac
            fi
        fi
    fi
}

semverParse() {
    major=&quot;${1%%.*}&quot;
    minor=&quot;${1#$major.}&quot;
    minor=&quot;${minor%%.*}&quot;
    patch=&quot;${1#$major.$minor.}&quot;
    patch=&quot;${patch%%[-.]*}&quot;
}

ee_notice() {
    echo
    echo
    echo &quot;  WARNING: $1 is now only supported by Docker EE&quot;
    echo &quot;           Check https://store.docker.com for information on Docker EE&quot;
    echo
    echo
}

do_install() {
    echo &quot;# Executing docker install script, commit: $SCRIPT_COMMIT_SHA&quot;

    if command_exists docker; then
        docker_version=&quot;$(docker -v | cut -d &#39; &#39; -f3 | cut -d &#39;,&#39; -f1)&quot;
        MAJOR_W=1
        MINOR_W=10

        semverParse &quot;$docker_version&quot;

        shouldWarn=0
        if [ &quot;$major&quot; -lt &quot;$MAJOR_W&quot; ]; then
            shouldWarn=1
        fi

        if [ &quot;$major&quot; -le &quot;$MAJOR_W&quot; ] &amp;&amp; [ &quot;$minor&quot; -lt &quot;$MINOR_W&quot; ]; then
            shouldWarn=1
        fi

        cat &gt;&amp;2 &lt;&lt;-&#39;EOF&#39;
            Warning: the &quot;docker&quot; command appears to already exist on this system.

            If you already have Docker installed, this script can cause trouble, which is
            why we&#39;re displaying this warning and provide the opportunity to cancel the
            installation.

            If you installed the current Docker package using this script and are using it
        EOF

        if [ $shouldWarn -eq 1 ]; then
            cat &gt;&amp;2 &lt;&lt;-&#39;EOF&#39;
            again to update Docker, we urge you to migrate your image store before upgrading
            to v1.10+.

            You can find instructions for this here:
            https://github.com/docker/docker/wiki/Engine-v1.10.0-content-addressability-migration
            EOF
        else
            cat &gt;&amp;2 &lt;&lt;-&#39;EOF&#39;
            again to update Docker, you can safely ignore this message.
            EOF
        fi

        cat &gt;&amp;2 &lt;&lt;-&#39;EOF&#39;

            You may press Ctrl+C now to abort this script.
        EOF
        ( set -x; sleep 20 )
    fi

    user=&quot;$(id -un 2&gt;/dev/null || true)&quot;

    sh_c=&#39;sh -c&#39;
    if [ &quot;$user&quot; != &#39;root&#39; ]; then
        if command_exists sudo; then
            sh_c=&#39;sudo -E sh -c&#39;
        elif command_exists su; then
            sh_c=&#39;su -c&#39;
        else
            cat &gt;&amp;2 &lt;&lt;-&#39;EOF&#39;
            Error: this installer needs the ability to run commands as root.
            We are unable to find either &quot;sudo&quot; or &quot;su&quot; available to make this happen.
            EOF
            exit 1
        fi
    fi

    if is_dry_run; then
        sh_c=&quot;echo&quot;
    fi

    # perform some very rudimentary platform detection
    lsb_dist=$( get_distribution )
    lsb_dist=&quot;$(echo &quot;$lsb_dist&quot; | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;)&quot;

    case &quot;$lsb_dist&quot; in

        ubuntu)
            if command_exists lsb_release; then
                dist_version=&quot;$(lsb_release --codename | cut -f2)&quot;
            fi
            if [ -z &quot;$dist_version&quot; ] &amp;&amp; [ -r /etc/lsb-release ]; then
                dist_version=&quot;$(. /etc/lsb-release &amp;&amp; echo &quot;$DISTRIB_CODENAME&quot;)&quot;
            fi
        ;;

        debian|raspbian)
            dist_version=&quot;$(sed &#39;s/\/.*//&#39; /etc/debian_version | sed &#39;s/\..*//&#39;)&quot;
            case &quot;$dist_version&quot; in
                9)
                    dist_version=&quot;stretch&quot;
                ;;
                8)
                    dist_version=&quot;jessie&quot;
                ;;
            esac
        ;;

        centos)
            if [ -z &quot;$dist_version&quot; ] &amp;&amp; [ -r /etc/os-release ]; then
                dist_version=&quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_ID&quot;)&quot;
            fi
        ;;

        rhel|ol|sles)
            ee_notice &quot;$lsb_dist&quot;
            exit 1
            ;;

        *)
            if command_exists lsb_release; then
                dist_version=&quot;$(lsb_release --release | cut -f2)&quot;
            fi
            if [ -z &quot;$dist_version&quot; ] &amp;&amp; [ -r /etc/os-release ]; then
                dist_version=&quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_ID&quot;)&quot;
            fi
        ;;

    esac

    # Check if this is a forked Linux distro
    check_forked

    # Run setup for each distro accordingly
    case &quot;$lsb_dist&quot; in
        ubuntu|debian|raspbian)
            pre_reqs=&quot;apt-transport-https ca-certificates curl&quot;
            if [ &quot;$lsb_dist&quot; = &quot;debian&quot; ]; then
                # libseccomp2 does not exist for debian jessie main repos for aarch64
                if [ &quot;$(uname -m)&quot; = &quot;aarch64&quot; ] &amp;&amp; [ &quot;$dist_version&quot; = &quot;jessie&quot; ]; then
                    add_debian_backport_repo &quot;$dist_version&quot;
                fi
            fi

            if ! command -v gpg &gt; /dev/null; then
                pre_reqs=&quot;$pre_reqs gnupg&quot;
            fi
            apt_repo=&quot;deb [arch=$(dpkg --print-architecture)] $DOWNLOAD_URL/linux/$lsb_dist $dist_version $CHANNEL&quot;
            (
                if ! is_dry_run; then
                    set -x
                fi
                $sh_c &#39;apt-get update -qq &gt;/dev/null&#39;
                $sh_c &quot;apt-get install -y -qq $pre_reqs &gt;/dev/null&quot;
                $sh_c &quot;curl -fsSL \&quot;$DOWNLOAD_URL/linux/$lsb_dist/gpg\&quot; | apt-key add -qq - &gt;/dev/null&quot;
                $sh_c &quot;echo \&quot;$apt_repo\&quot; &gt; /etc/apt/sources.list.d/docker.list&quot;
                $sh_c &#39;apt-get update -qq &gt;/dev/null&#39;
            )
            pkg_version=&quot;&quot;
            if [ -n &quot;$VERSION&quot; ]; then
                if is_dry_run; then
                    echo &quot;# WARNING: VERSION pinning is not supported in DRY_RUN&quot;
                else
                    # Will work for incomplete versions IE (17.12), but may not actually grab the &quot;latest&quot; if in the test channel
                    pkg_pattern=&quot;$(echo &quot;$VERSION&quot; | sed &quot;s/-ce-/~ce~.*/g&quot; | sed &quot;s/-/.*/g&quot;).*-0~$lsb_dist&quot;
                    search_command=&quot;apt-cache madison &#39;docker-ce&#39; | grep &#39;$pkg_pattern&#39; | head -1 | awk &#39;{\$1=\$1};1&#39; | cut -d&#39; &#39; -f 3&quot;
                    pkg_version=&quot;$($sh_c &quot;$search_command&quot;)&quot;
                    echo &quot;INFO: Searching repository for VERSION &#39;$VERSION&#39;&quot;
                    echo &quot;INFO: $search_command&quot;
                    if [ -z &quot;$pkg_version&quot; ]; then
                        echo
                        echo &quot;ERROR: &#39;$VERSION&#39; not found amongst apt-cache madison results&quot;
                        echo
                        exit 1
                    fi
                    search_command=&quot;apt-cache madison &#39;docker-ce-cli&#39; | grep &#39;$pkg_pattern&#39; | head -1 | awk &#39;{\$1=\$1};1&#39; | cut -d&#39; &#39; -f 3&quot;
                    # Don&#39;t insert an = for cli_pkg_version, we&#39;ll just include it later
                    cli_pkg_version=&quot;$($sh_c &quot;$search_command&quot;)&quot;
                    pkg_version=&quot;=$pkg_version&quot;
                fi
            fi
            (
                if ! is_dry_run; then
                    set -x
                fi
                if [ -n &quot;$cli_pkg_version&quot; ]; then
                    $sh_c &quot;apt-get install -y -qq --no-install-recommends docker-ce-cli=$cli_pkg_version &gt;/dev/null&quot;
                fi
                $sh_c &quot;apt-get install -y -qq --no-install-recommends docker-ce$pkg_version &gt;/dev/null&quot;
            )
            echo_docker_as_nonroot
            exit 0
            ;;
        centos|fedora)
            yum_repo=&quot;$DOWNLOAD_URL/linux/$lsb_dist/$REPO_FILE&quot;
            if ! curl -Ifs &quot;$yum_repo&quot; &gt; /dev/null; then
                echo &quot;Error: Unable to curl repository file $yum_repo, is it valid?&quot;
                exit 1
            fi
            if [ &quot;$lsb_dist&quot; = &quot;fedora&quot; ]; then
                pkg_manager=&quot;dnf&quot;
                config_manager=&quot;dnf config-manager&quot;
                enable_channel_flag=&quot;--set-enabled&quot;
                disable_channel_flag=&quot;--set-disabled&quot;
                pre_reqs=&quot;dnf-plugins-core&quot;
                pkg_suffix=&quot;fc$dist_version&quot;
            else
                pkg_manager=&quot;yum&quot;
                config_manager=&quot;yum-config-manager&quot;
                enable_channel_flag=&quot;--enable&quot;
                disable_channel_flag=&quot;--disable&quot;
                pre_reqs=&quot;yum-utils&quot;
                pkg_suffix=&quot;el&quot;
            fi
            (
                if ! is_dry_run; then
                    set -x
                fi
                $sh_c &quot;$pkg_manager install -y -q $pre_reqs&quot;
                $sh_c &quot;$config_manager --add-repo $yum_repo&quot;

                if [ &quot;$CHANNEL&quot; != &quot;stable&quot; ]; then
                    $sh_c &quot;$config_manager $disable_channel_flag docker-ce-*&quot;
                    $sh_c &quot;$config_manager $enable_channel_flag docker-ce-$CHANNEL&quot;
                fi
                $sh_c &quot;$pkg_manager makecache&quot;
            )
            pkg_version=&quot;&quot;
            if [ -n &quot;$VERSION&quot; ]; then
                if is_dry_run; then
                    echo &quot;# WARNING: VERSION pinning is not supported in DRY_RUN&quot;
                else
                    pkg_pattern=&quot;$(echo &quot;$VERSION&quot; | sed &quot;s/-ce-/\\\\.ce.*/g&quot; | sed &quot;s/-/.*/g&quot;).*$pkg_suffix&quot;
                    search_command=&quot;$pkg_manager list --showduplicates &#39;docker-ce&#39; | grep &#39;$pkg_pattern&#39; | tail -1 | awk &#39;{print \$2}&#39;&quot;
                    pkg_version=&quot;$($sh_c &quot;$search_command&quot;)&quot;
                    echo &quot;INFO: Searching repository for VERSION &#39;$VERSION&#39;&quot;
                    echo &quot;INFO: $search_command&quot;
                    if [ -z &quot;$pkg_version&quot; ]; then
                        echo
                        echo &quot;ERROR: &#39;$VERSION&#39; not found amongst $pkg_manager list results&quot;
                        echo
                        exit 1
                    fi
                    search_command=&quot;$pkg_manager list --showduplicates &#39;docker-ce-cli&#39; | grep &#39;$pkg_pattern&#39; | tail -1 | awk &#39;{print \$2}&#39;&quot;
                    # It&#39;s okay for cli_pkg_version to be blank, since older versions don&#39;t support a cli package
                    cli_pkg_version=&quot;$($sh_c &quot;$search_command&quot; | cut -d&#39;:&#39; -f 2)&quot;
                    # Cut out the epoch and prefix with a &#39;-&#39;
                    pkg_version=&quot;-$(echo &quot;$pkg_version&quot; | cut -d&#39;:&#39; -f 2)&quot;
                fi
            fi
            (
                if ! is_dry_run; then
                    set -x
                fi
                # install the correct cli version first
                if [ -n &quot;$cli_pkg_version&quot; ]; then
                    $sh_c &quot;$pkg_manager install -y -q docker-ce-cli-$cli_pkg_version&quot;
                fi
                $sh_c &quot;$pkg_manager install -y -q docker-ce$pkg_version&quot;
            )
            echo_docker_as_nonroot
            exit 0
            ;;
        *)
            echo
            echo &quot;ERROR: Unsupported distribution &#39;$lsb_dist&#39;&quot;
            echo
            exit 1
            ;;
    esac
    exit 1
}

# wrapped up in a function so that we have some protection against only getting
# half the file during &quot;curl | sh&quot;
do_install
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="04.DockerFile%E4%BC%81%E4%B8%9A%E6%A1%88%E4%BE%8B%E5%9B%9B.html" class="btn btn-neutral float-left" title="DockerFile企业案例四" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="06.%E4%BD%BF%E7%94%A8Supervisor%E8%BF%90%E8%A1%8CWordPress.html" class="btn btn-neutral float-right" title="使用Supervisor运行WordPress" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>