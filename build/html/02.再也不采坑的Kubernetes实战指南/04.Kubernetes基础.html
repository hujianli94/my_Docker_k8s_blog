

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Kubernetes基础 &mdash; 运维开发修炼之路</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'1.0.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: ''
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="prev" title="Docker基础" href="03.Docker基础.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 小健_Docker_K8s_Blog
          

          
            
            <img src="../_static/docker-k8s.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01.Docker技术入门与实战-3版/index.html">01.Docker技术入门与实战-第3版</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">02.再也不采坑的Kubernetes实战指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01.通过Kubeadm部署kubernetes.html">通过Kubeadm部署kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.Kubespray部署k8s.html">Kubespray部署k8s</a></li>
<li class="toctree-l2"><a class="reference internal" href="03.Docker基础.html">Docker基础</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Kubernetes基础</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#master">Master节点</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#apiserver">APIServer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scheduler">Scheduler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controller-manager">Controller Manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="#etcd">Etcd</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#node">Node节点</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#kubelet">Kubelet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kube-proxy">Kube-Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-engine">Docker Engine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pod">Pod</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">1.什么是Pod?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#podpod">2.Pod探针Pod探针</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">3.Pod镜像拉取策略和重启策略</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">4.创建一个Pod</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">小健_Docker_K8s_Blog</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">02.再也不采坑的Kubernetes实战指南</a> &raquo;</li>
        
      <li>Kubernetes基础</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/02.再也不采坑的Kubernetes实战指南/04.Kubernetes基础.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#kubernetes" id="id4">Kubernetes基础</a><ul>
<li><a class="reference internal" href="#master" id="id5">Master节点</a><ul>
<li><a class="reference internal" href="#apiserver" id="id6">APIServer</a></li>
<li><a class="reference internal" href="#scheduler" id="id7">Scheduler</a></li>
<li><a class="reference internal" href="#controller-manager" id="id8">Controller Manager</a></li>
<li><a class="reference internal" href="#etcd" id="id9">Etcd</a></li>
</ul>
</li>
<li><a class="reference internal" href="#node" id="id10">Node节点</a><ul>
<li><a class="reference internal" href="#kubelet" id="id11">Kubelet</a></li>
<li><a class="reference internal" href="#kube-proxy" id="id12">Kube-Proxy</a></li>
<li><a class="reference internal" href="#docker-engine" id="id13">Docker Engine</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pod" id="id14">Pod</a><ul>
<li><a class="reference internal" href="#id1" id="id15">1.什么是Pod?</a></li>
<li><a class="reference internal" href="#podpod" id="id16">2.Pod探针Pod探针</a></li>
<li><a class="reference internal" href="#id2" id="id17">3.Pod镜像拉取策略和重启策略</a></li>
<li><a class="reference internal" href="#id3" id="id18">4.创建一个Pod</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="kubernetes">
<h1><a class="toc-backref" href="#id4">Kubernetes基础</a><a class="headerlink" href="#kubernetes" title="Permalink to this headline">¶</a></h1>
<p>Kubernetes致力于提供跨主机集群的自动部署、扩展、高可用以及运行应用程序容器的平台，其遵循主从式架构设计，其组件可以分为管理单个节点（Node）组件和控制平面组件。Kubernetes
Master是集群的主要控制单元，用于管理其工作负载并指导整个系统的通信。Kubernetes控制平面由各自的进程组成，每个组件都可以在单个主节点上运行，也可以在支持高可用集群的多个节点上运行。</p>
<div class="section" id="master">
<h2><a class="toc-backref" href="#id5">Master节点</a><a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h2>
<p>Master节点是Kubernetes集群的控制节点，在生产环境中不建议部署集群核心组件外的任何Pod，<strong>公司业务的Pod更是不建议部署到Master节点上，以免升级或者维护时对业务造成影响</strong>。Master节点的组件包括：</p>
<div class="section" id="apiserver">
<h3><a class="toc-backref" href="#id6">APIServer</a><a class="headerlink" href="#apiserver" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>APIServer是整个集群的控制中枢，提供集群中各个模块之间的数据交换，并将集群状态和信息存储到分布式键－值（key-value）存储系统Etcd集群中。同时它也是集群管理、资源配额、提供完备的集群安全机制的入口，为集群各类资源对象提供增删改查以及watch的REST API接口。

APIServer作为Kubernetes的关键组件，使用Kubernetes API和JSON overHTTP提供Kubernetes的内部和外部接口。
</pre></div>
</div>
</div>
<div class="section" id="scheduler">
<h3><a class="toc-backref" href="#id7">Scheduler</a><a class="headerlink" href="#scheduler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>Scheduler是集群Pod的调度中心，主要是通过调度算法将Pod分配到最佳的节点（Node），它通过APIServer监听所有Pod的状态，一旦发现新的未被调度到任何Node节点的Pod（PodSpec.NodeName为空），就会根据一系列策略选择最佳节点进行调度，对每一个Pod创建一个绑定（binding），然后被调度的节点上的Kubelet负责启动该Pod。Scheduler是集群可插拔式组件，它跟踪每个节点上的资源利用率以确保工作负载不会超过可用资源。因此Scheduler必须知道资源需求、资源可用性以及其他约束和策略，例如服务质量、亲和力／反关联性要求、数据位置等。Scheduler将资源供应与工作负载需求相匹配以维持系统的稳定和可靠，因此Scheduler在调度的过程中需要考虑公平、资源高效利用、效率等方面的问题。
</pre></div>
</div>
</div>
<div class="section" id="controller-manager">
<h3><a class="toc-backref" href="#id8">Controller Manager</a><a class="headerlink" href="#controller-manager" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>Controller Manager是集群状态管理器（它的英文直译名为控制器管理器），以保证Pod或其他资源达到期望值。

当集群中某个Pod的副本数或其他资源因故障和错误导致无法正常运行，没有达到设定的值时，Controller Manager会尝试自动修复并使其达到期望状态。

Controller Manager包含NodeController、ReplicationController、EndpointController、NamespaceController、ServiceAccountController、ResourceQuotaController、ServiceController和TokenController，该控制器管理器可与API服务器进行通信以在需要时创建、更新或删除它所管理的资源，如Pod、服务断点等。
</pre></div>
</div>
</div>
<div class="section" id="etcd">
<h3><a class="toc-backref" href="#id9">Etcd</a><a class="headerlink" href="#etcd" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>Etcd由CoreOS开发，用于可靠地存储集群的配置数据，是一种持久性、轻量型、分布式的键－值（key-value）数据存储组件。

Etcd作为Kubernetes集群的持久化存储系统，集群的灾难恢复和状态信息存储都与其密不可分，所以在Kubernetes高可用集群中，Etcd的高可用是至关重要的一部分，在生产环境中建议部署为大于3的奇数个数的Etcd，以保证数据的安全性和可恢复性。Etcd可与Master组件部署在同一个节点上，大规模集群环境下建议部署在集群外，并且使用高性能服务器来提高Etcd的性能和降低Etcd同步数据的延迟。
</pre></div>
</div>
</div>
</div>
<div class="section" id="node">
<h2><a class="toc-backref" href="#id10">Node节点</a><a class="headerlink" href="#node" title="Permalink to this headline">¶</a></h2>
<p>Node节点也被称为Worker或Minion，是主要负责部署容器（工作负载）的单机（或虚拟机），集群中的每个节点都必须具备容器的运行环境（runtime），比如Docker及其他组件等。Kubelet作为守护进程运行在Node节点上，负责监听该节点上所有的Pod，同时负责上报该节点上所有Pod的运行状态，确保节点上的所有容器都能正常运行。当Node节点宕机（NotReady状态）时，该节点上运行的Pod会被自动地转移到其他节点上。</p>
<p>Node节点包括：</p>
<div class="section" id="kubelet">
<h3><a class="toc-backref" href="#id11">Kubelet</a><a class="headerlink" href="#kubelet" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>负责与Master通信协作，管理该节点上的Pod。
</pre></div>
</div>
</div>
<div class="section" id="kube-proxy">
<h3><a class="toc-backref" href="#id12">Kube-Proxy</a><a class="headerlink" href="#kube-proxy" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>负责各Pod之间的通信和负载均衡。
</pre></div>
</div>
</div>
<div class="section" id="docker-engine">
<h3><a class="toc-backref" href="#id13">Docker Engine</a><a class="headerlink" href="#docker-engine" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>Docker引擎，负载对容器的管理。
</pre></div>
</div>
</div>
</div>
<div class="section" id="pod">
<h2><a class="toc-backref" href="#id14">Pod</a><a class="headerlink" href="#pod" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id15">1.什么是Pod?</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Pod可简单地理解为是一组、一个或多个容器，具有共享存储／网络及如何运行容器的规范。</p>
<p>Pad包含一个或多个相对紧密耦合的应用程序容器，处于同一个Pod中的容器共享同样的存储空间（Volume，卷或存储卷）、IP地址和Port端口，容器之间使用localhost:port相互访问。根据Docker的构造，Pod可被建模为一组具有共享命令空间、卷、IP地址和Port端口的Docker容器。Pod包含的容器最好是一个容器只运行一个进程。每个Pod包含一个pause容器，pause容器是Pod的父容器，它主要负责僵尸进程的回收管理。Kubernetes为每个Pod都分配一个唯一的IP地址，这样就可以保证应用程序使用同一端口，避免了发生冲突的问题。一个Pod的状态信息保存在PodStatus对象中，在PodStatus中有一个Phase字段，用于描述Pod在其生命周期中的不同状态。</p>
<p>Pod状态字段Phase的不同取值</p>
<p><img alt="image0" src="../_images/pod_status0001.png" /></p>
</div>
<div class="section" id="podpod">
<h3><a class="toc-backref" href="#id16">2.Pod探针Pod探针</a><a class="headerlink" href="#podpod" title="Permalink to this headline">¶</a></h3>
<p>用来检测容器内的应用是否正常，目前有三种实现方式.</p>
<p>Pod探针的实现方式</p>
<p><img alt="image1" src="../_images/pod_tanzheng00001.png" /></p>
<p>Pod探针每次检查容器后可能得到的容器状态</p>
<p><img alt="image2" src="../_images/pod_tanzheng00002.png" /></p>
<p>Kubelet有两种探针（即探测器）可以选择性地对容器进行检测</p>
<p><img alt="image3" src="../_images/pod_tanzheng00003.png" /></p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id17">3.Pod镜像拉取策略和重启策略</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Pod镜像拉取策略。用于配置当节点部署Pod时，对镜像的操作方式</p>
<p>镜像拉取策略</p>
<p><img alt="image4" src="../_images/k8s_pod_restart00001.png" /></p>
<p>Pod重启策略。在Pod发生故障时对Pod的处理方式</p>
<p>Pod重启策略</p>
<p><img alt="image5" src="../_images/pod_restart00005.png" /></p>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id18">4.创建一个Pod</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>在生产环境中，很少会单独启动一个Pod直接使用，经常会用Deployment、DaemonSet、StatefulSet等方式调度并管理Pod，定义Pod的参数同时适应于Deployment、DaemonSet、StatefulSet等方式。</p>
<p>在Kubeadm安装方式下，kubernetes系统组件都是用单独的Pod启动的，当然有时候也会单独启动一个Pod用于测试业务等，此时可以单独创建一个Pod。</p>
<p>创建一个Pod的标准格式如下：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Pod</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">myapp</span><span class="o">-</span><span class="n">pod</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">myapp</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">containers</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">myapp</span><span class="o">-</span><span class="n">container</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">busybox</span>
    <span class="n">command</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;echo The app is running! &amp;&amp; sleep 3600&#39;</span><span class="p">]</span>
  <span class="n">initContainers</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">init</span><span class="o">-</span><span class="n">myservice</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">busybox</span>
    <span class="n">command</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;until nslookup myservice; do echo waiting for myservice; sleep 2; done;&#39;</span><span class="p">]</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">init</span><span class="o">-</span><span class="n">mydb</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">busybox</span>
    <span class="n">command</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;until nslookup mydb; do echo waiting for mydb; sleep 2; done;&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="03.Docker基础.html" class="btn btn-neutral float-left" title="Docker基础" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, huxiaojian

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>