.. contents::
   :depth: 3
..

Helm相关
========

查看Charts仓库信息
------------------

::

    [root@ci-base home]# helm repo list
    NAME            URL
    ingress-nginx   https://kubernetes.github.io/ingress-nginx
    stable          http://mirror.azure.cn/kubernetes/charts
    aliyun          https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts

常见操作
--------

::

    # 新增国内仓库，并进行更新操作
    helm repo add stable http://mirror.azure.cn/kubernetes/charts/
    helm update
    helm repo list


    # 列出stable仓库中维护的所有Charts的列表
    helm search repo

    # 列出复合条件的Charts，过滤器查找
    helm search repo redis
    helm ls --all-namespaces



    # 查看Charts的详细信息
    [root@ci-base home]# helm inspect chart stable/redis
    apiVersion: v1
    appVersion: 5.0.7
    deprecated: true
    description: DEPRECATED Open source, advanced key-value store. It is often referred
      to as a data structure server since keys can contain strings, hashes, lists, sets
      and sorted sets.
    home: http://redis.io/
    icon: https://bitnami.com/assets/stacks/redis/img/redis-stack-220x234.png
    keywords:
    - redis
    - keyvalue
    - database
    name: redis
    sources:
    - https://github.com/bitnami/bitnami-docker-redis
    version: 10.5.7

安装stable/redis在ns=redis中
----------------------------

::

    //创建
    helm search repo redis
    kubectl create namespace redis
    helm install chart stable/redis -n redis --dry-run
    helm install chart stable/redis -n redis


    //查看创建的charts,查看所有ns
    [root@ci-base home]# helm list --all-namespaces
    NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION
    chart           redis           1               2020-11-13 15:11:53.740004087 +0800 CST deployed        redis-10.5.7            5.0.7

    //查看单个ns
    [root@ci-base ~]# helm list -n ci-gitee-10523


    //删除命名空间中的chart
    [root@ci-base home]# helm -n redis uninstall chart
    release "chart" uninstalled

    [root@ci-base home]# helm list -A
    NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION

::

    # 安装stable/redis

    //创建
    [root@ci-base home]# helm install redis stable/redis

    //查看
    [root@ci-base home]# helm list
    NAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION
    redis   default         1               2020-11-13 15:24:01.368251708 +0800 CST deployed        redis-10.5.7    5.0.7

    //删除
    [root@ci-base home]# helm uninstall redis
    或者使用delete
    [root@ci-base home]# helm delete redis
    release "redis" uninstalled

    [root@ci-base home]# helm list


    # 回滚
    helm rollback
    //命令格式：
    helm rollback <RELEASE> [REVISION] [flags]
    [aiops@3 test]$ helm rollback helloworld 1


    # 升级
    helm upgrade

    //命令语法：
    helm uninstall RELEASE_NAME [flags]

    # 获取指定Release变更历史
    helm history

    //获取某个release历史的安装更新记录
    $ helm history helloworld


    # helm pull
    //从chart仓库中下载打包好的chart到本地存储
    [aiops@3 test]$ helm pull stable/mysql

helm包检查项目
--------------

::

    # helm包检查项目
    [root@ci-base ~]# helm list --all-namespaces

    [root@ci-base ~]# kubectl get cm -n ci-gitee-10523

    [root@ci-base ~]# kubectl get Deployment -n ci-gitee-10523

    [root@ci-base ~]# kubectl get svc -n ci-gitee-10523

    [root@ci-base ~]# kubectl get Ingress -n ci-gitee-10523

    [root@ci-base ~]# kubectl get pod -n ci-gitee-10523


    # 查看资源信息
    kubectl describe -n dev pod cigiteebe-7c5b7486c-pc22z

Helm安装和卸载
--------------

::

    # helm安装和卸载
    [root@ci-base home]# helm install myapp --debug ./mychart --set service.type=NodePort
    [root@ci-base home]# helm uninstall myapp


    [root@ci-base home]# helm uninstall chart
    [root@ci-base home]# helm list


    # 删除命名空间ci-gitee-11856中的chart
    helm uninstall -n ci-gitee-11856 ci-gitee-11856

    #删除命名空间dev中的chart
    helm uninstall -n dev dev


    正确姿势
    1、brew install helm
    2、helm repo add stable http://mirror.azure.cn/kubernetes/charts/
    3、helm repo update
    4、helm install stable/xxx



    helm install --name myapp --dry-run --debug ./mychart --set service.type=NodePort
    helm install --name myapp --debug ./mychart --set service.type=NodePort

参考文献
--------

https://blog.csdn.net/weixin\_36938307/article/details/105245770
