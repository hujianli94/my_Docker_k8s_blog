

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Docker镜像的使用 &mdash; 运维开发修炼之路</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'1.0.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: ''
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="next" title="操作Docker容器" href="03.操作Docker容器.html" />
    <link rel="prev" title="初识Docker与容器" href="01.初识Docker与容器.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 小健_Docker_K8s_Blog
          

          
            
            <img src="../_static/docker-k8s.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">01.Docker技术入门与实战-第3版</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01.初识Docker与容器.html">初识Docker与容器</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Docker镜像的使用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">镜像写时复制机制</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">本地镜像管理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">获取镜像</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">查看镜像</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">搜寻镜像</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">下载镜像</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">删除镜像</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id8">创建本地镜像</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#commit">使用commit命令创建本地镜像</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dockerfile">使用 Dockerfile 创建镜像</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id9">基于本地模板导入</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">存出和载入镜像</a></li>
<li class="toctree-l3"><a class="reference internal" href="#docker-hub">Docker Hub</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">镜像的分发</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">上传镜像</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">搭建自己的私有仓库</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="03.操作Docker容器.html">操作Docker容器</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.访问Docker仓库.html">访问Docker仓库</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.搭建本地私有仓库.html">搭建本地私有仓库</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.Docker数据管理.html">Docker数据管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="07.Docker使用网络.html">Docker使用网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.使用Dockerfile创建镜像.html">使用Dockerfile创建镜像</a></li>
<li class="toctree-l2"><a class="reference internal" href="09.实战案例.html">实战案例</a></li>
<li class="toctree-l2"><a class="reference internal" href="10.Docker核心实现技术.html">Docker核心实现技术</a></li>
<li class="toctree-l2"><a class="reference internal" href="11.配置私有仓库.html">配置私有仓库</a></li>
<li class="toctree-l2"><a class="reference internal" href="12.安全防护与配置.html">安全防护与配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="13.高级网络功能.html">高级网络功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="14.libnetwork插件化网络功能.html">libnetwork插件化网络功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="16.Docker三剑客之-Compose.html">Docker三剑客之-Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="17.Docker三剑客之Docker-Swarm.html">Docker三剑客之Docker-Swarm</a></li>
<li class="toctree-l2"><a class="reference internal" href="18.Docker三剑客之Docker-Machine.html">Docker三剑客之Docker-Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="19.SwarmKit集群解决方案.html">SwarmKit集群解决方案</a></li>
<li class="toctree-l2"><a class="reference internal" href="20.搭建一个Web应用栈.html">搭建一个Web应用栈</a></li>
<li class="toctree-l2"><a class="reference internal" href="21.Docker高级网络实战.html">Docker高级网络实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="22.服务发现.html">服务发现</a></li>
<li class="toctree-l2"><a class="reference internal" href="23.Mesos——优秀的集群资源调度平台.html">Mesos——优秀的集群资源调度平台</a></li>
<li class="toctree-l2"><a class="reference internal" href="24.Kubernetes——生产级容器集群平台.html">Kubernetes——生产级容器集群平台</a></li>
<li class="toctree-l2"><a class="reference internal" href="25.其他相关项目.html">其他相关项目</a></li>
<li class="toctree-l2"><a class="reference internal" href="26.附录.html">附录</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">小健_Docker_K8s_Blog</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">01.Docker技术入门与实战-第3版</a> &raquo;</li>
        
      <li>Docker镜像的使用</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/01.Docker技术入门与实战-3版/02.Docker镜像的使用.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#docker" id="id14">Docker镜像的使用</a><ul>
<li><a class="reference internal" href="#id1" id="id15">镜像写时复制机制</a></li>
<li><a class="reference internal" href="#id2" id="id16">本地镜像管理</a><ul>
<li><a class="reference internal" href="#id3" id="id17">获取镜像</a></li>
<li><a class="reference internal" href="#id4" id="id18">查看镜像</a></li>
<li><a class="reference internal" href="#id5" id="id19">搜寻镜像</a></li>
<li><a class="reference internal" href="#id6" id="id20">下载镜像</a></li>
<li><a class="reference internal" href="#id7" id="id21">删除镜像</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8" id="id22">创建本地镜像</a><ul>
<li><a class="reference internal" href="#commit" id="id23">使用commit命令创建本地镜像</a></li>
<li><a class="reference internal" href="#dockerfile" id="id24">使用 Dockerfile 创建镜像</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9" id="id25">基于本地模板导入</a></li>
<li><a class="reference internal" href="#id10" id="id26">存出和载入镜像</a></li>
<li><a class="reference internal" href="#docker-hub" id="id27">Docker Hub</a><ul>
<li><a class="reference internal" href="#id11" id="id28">镜像的分发</a></li>
<li><a class="reference internal" href="#id12" id="id29">上传镜像</a></li>
<li><a class="reference internal" href="#id13" id="id30">搭建自己的私有仓库</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="docker">
<h1><a class="toc-backref" href="#id14">Docker镜像的使用</a><a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h1>
<p><strong>镜像</strong>
是Docker三大核心概念中最重要的，自Docker诞生之日起镜像就是相关社区最为热门的关键词。</p>
<p>Docker运行容器前需要本地存在对应的镜像，如果镜像不存在，Docker会尝试先从默认镜像仓库下载（默认使用Docker
Hub公共注册服务器中的仓库），用户也可以通过配置，使用自定义的镜像仓库。</p>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id15">镜像写时复制机制</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span>通过 docker run 命令指定镜像创建一个容器时，实际上是在该镜像之上创建一个空的可读写
文件系统层级。可以将这个文件系统当成一个新的临时镜像，而命令里所指定的镜像称为父镜像。
父镜像的内容都是以只读方式挂载进来的，容器会读取共享父镜像的内容。不过一旦需要修改父
镜像文件，便会触发Docker从父镜像中复制这个文件到临时镜像中来，所有的修改均发生你的文
件系统中，而不会对父镜像造成任何影响，这就是Docker镜像的写时复制机制。
</pre></div>
</div>
<p><strong>docker镜像的分层</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#启动一个nginx容器
docker run -d -p 80:80 --name webserver nginx

#从Docker Hub的Ubuntu仓库下载一个最新的Ubuntu操作系统的镜像。
docker pull ubuntu

#*  镜像的latest标签意味着该镜像的内容会跟踪最新的非稳定版本而发布，内容是不稳定的。不要在生产环境中忽略镜像的标签信息或使用默认的latest标记的镜像。

例如，docker pull ubuntu：14.04命令相当于docker pull registry.hub.docker.com/ubuntu：14.04命令，即从默认的注册服务器Docker Hub Registry中的ubuntu仓库来下载标记为14.04的镜像。 如果从非官方的仓库下载，则需要在仓库名称前指定完整的仓库地址。

#例如从网易蜂巢的镜像源来下载ubuntu：14.04镜像，可以使用如下命令，此时下载的镜像名称为hub.c.163.com/public/ubuntu：14.04：

#下载阿里云的镜像
docker pull registry.cn-beijing.aliyuncs.com/mysqld/mysql

#使用tag命令添加镜像标签
docker tag ubuntu:latest myubuntu:latest


#使用inspect命令查看详细信息
docker inspect ubuntu

#返回的是一个JSON格式的消息，如果我们只要其中一项内容时，可以使用参数-f来指定
docker inspect -f {{&quot;.Architecture&quot;}} ubuntu


#使用history命令查看镜像历史
docker history ubuntu

#搜寻镜像,在Docker Hub上搜索符合要求的镜像
docker search nginx
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id16">本地镜像管理</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id17">获取镜像</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>镜像是运行容器的前提，官方的Docker
Hub网站已经提供了数十万个镜像供大家开放下载。本节主要介绍Docker镜像的pull子命令。</p>
<p>可以使用docker[image]pull命令直接从Docker
Hub镜像源来下载镜像。该命令的格式为docker[image]pull NAME[：TAG]。</p>
<p>其中，NAME是镜像仓库名称（用来区分镜像），TAG是镜像的标签（往往用来表示版本信息）。通常情况下，描述一个镜像需要包括“名称+标签”信息。</p>
<p>例如，获取一个Ubuntu 18.04系统的基础镜像可以使用如下的命令：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker pull ubuntu:18.04
</pre></div>
</div>
<p>对于Docker镜像来说，如果不显式指定TAG，则默认会选择latest标签，这会下载仓库中最新版本的镜像。</p>
<p>下面的例子将从Docker
Hub的Ubuntu仓库下载一个最新版本的Ubuntu操作系统的镜像：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker pull ubuntu
</pre></div>
</div>
<p>该命令实际上下载的就是ubuntu：latest镜像。</p>
<p>下载镜像到本地后，即可随时使用该镜像了，例如利用该镜像创建一个容器，在其中运行bash应用，执行打印“Hello
World”命令：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker run -it ubuntu:18.04 bash
root@65663247040f:/# echo &quot;Hello World&quot;
Hello World
root@65663247040f:/# exit
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id18">查看镜像</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><strong>1.使用images命令列出镜像</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">images</span>

<span class="n">docker</span> <span class="n">images</span> <span class="n">ubun</span><span class="o">*</span>
</pre></div>
</div>
<p><strong>2.使用tag命令添加镜像标签</strong></p>
<p>为了方便在后续工作中使用特定镜像，还可以使用docker
tag命令来为本地镜像任意添加新的标签。例如，添加一个新的myubuntu：latest镜像标签：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">tag</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">latest</span> <span class="n">myubuntu</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<p>再次使用docker
images列出本地主机上镜像信息，可以看到多了一个myubuntu：latest标签的镜像：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker images
REPOSITORY           TAG           IMAGE ID           CREATED             SIZE
ubuntu               18.04         452a96d81c30       2 weeks ago         79.6MB
ubuntu               latest        452a96d81c30       2 weeks ago         79.6MB
myubuntu             latest        452a96d81c30       2 weeks ago         79.6MB
</pre></div>
</div>
<p><strong>3.使用inspect命令查看详细信息</strong></p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ docker [image] inspect ubuntu:18.04
[
    {
        &quot;Id&quot;: &quot;sha256:452a96d81c30a1e426bc250428263ac9ca3f47c9bf086f876d11cb39cf57aeec&quot;,
        &quot;RepoTags&quot;: [
            &quot;ubuntu:18.04&quot;,
            &quot;ubuntu:latest&quot;
        ],
        &quot;RepoDigests&quot;: [
            &quot;ubuntu@sha256:c8c275751219dadad8fa56b3ac41ca6cb22219ff117ca98fe82b42f24e1ba64e&quot;
        ],
        &quot;Parent&quot;: &quot;&quot;,
        &quot;Comment&quot;: &quot;&quot;,
        &quot;Created&quot;: &quot;2018-04-27T23:28:36.319694807Z&quot;,
        ...
]
</pre></div>
</div>
<p>上面代码返回的是一个JSON格式的消息，如果我们只要其中一项内容时，可以使用-f来指定，例如，获取镜像的Architecture：</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ docker [image] inspect -f {{&quot;.Architecture&quot;}} ubuntu:18.04
amd64
</pre></div>
</div>
<p><strong>4.使用history命令查看镜像历史</strong></p>
<p>既然镜像文件由多个层组成，那么怎么知道各个层的内容具体是什么呢？这时候可以使用history子命令，该命令将列出各层的创建信息。</p>
<p>例如，查看ubuntu：18.04镜像的创建过程，可以使用如下命令：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker history ubuntu:18.04
IMAGE        CREATED       CREATED BY              SIZE                   COMMENT
452a96d81c30 5 weeks ago   /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]           0B
&lt;missing&gt;    5 weeks ago   /bin/sh -c mkdir -p /run/systemd &amp;&amp; echo &#39;do… 7B
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">注意，过长的命令被自动截断了，可以使用前面提到的--no-trunc选项来输出完整命令。</span></code></p>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id19">搜寻镜像</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>使用docker search命令可以搜索Docker Hub官方仓库中的镜像。语法为docker
search[option]keyword。支持的命令选项主要包括：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>·-f，--filter filter：过滤输出内容；

·--format string：格式化输出内容；

·--limit int：限制输出结果个数，默认为25个；

·--no-trunc：不截断输出结果。
</pre></div>
</div>
<p>例如，搜索官方提供的带nginx关键字的镜像，如下所示：</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ docker search --filter=is-official=true nginx
NAME DESCRIPTION STARS OFFICIAL AUTOMATED
nginx Official build of Nginx. 7978 [OK]
kong Open-source Microservice &amp; API Management la… 159 [OK]
</pre></div>
</div>
<p>再比如，搜索所有收藏数超过4的关键词包括tensorflow的镜像：</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ docker search --filter=stars=4 tensorflow
NAME DESCRIPTION STARS OFFICIAL AUTOMATED
tensorflow/tensorflow Official docker images for deep learning fra…   760
xblaster/tensorflow-jupyter Dockerized Jupyter with tensorflow 47 [OK]
jupyter/tensorflow-notebook Jupyter Notebook Scientific Python Stack w/ …   46
romilly/rpi-docker-tensorflow Tensorflow and Jupyter running in docker con…   16
floydhub/tensorflow tensorflow 8 [OK]
erroneousboat/tensorflow-python3-jupyter Docker container with python 3 version of te…   8 [OK]
tensorflow/tf_grpc_server Server for TensorFlow GRPC Distributed Runti…   5
</pre></div>
</div>
<p>可以看到返回了很多包含关键字的镜像，其中包括镜像名字、描述、收藏数（表示该镜像的受欢迎程度）、是否官方创建、是否自动创建等。默认的输出结果将按照星级评价进行排序。</p>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id20">下载镜像</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># 首先本地搜索ubuntu镜像，如果没有就去Docker Hub上拉取ubuntu镜像</span>
<span class="n">docker</span> <span class="n">run</span> <span class="n">ubuntu</span> <span class="n">echo</span> <span class="s2">&quot;hello docker&quot;</span>

<span class="c1">#搜索符合要求的镜像</span>
<span class="n">docker</span> <span class="n">serach</span> <span class="n">wordpress</span>


<span class="c1"># 可以预先拉取镜像，放置到本地</span>
<span class="n">docker</span> <span class="n">pull</span> <span class="n">ubuntu</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id21">删除镜像</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>#1.使用标签删除镜像
docker rmi myubuntu:latest

#2.使用镜像ID删除镜像
docker rmi 91e7d180c6a3

#想强行删除镜像，可以使用-f参数
docker rmi -f 47b19964fb50


#通常并不推荐使用-f参数来强制删除一个存在容器依赖的镜像。正确的做法是，先删除依赖该镜像的所有容器，再来删除镜像
[root@iZ2ze38chylj63vuj6fqiaZ ~]# docker rm e90b01fe1248
e90b01fe1248

# 删除本地停止运行的容器，一次性删除无用的容器对镜像的依赖
docker rm $(docker ps -a -q)

# 删除所有镜像
docker rmi -f $(docker images|grep -v REPOSITORY|awk &#39;{print $1&quot;:&quot;$2}&#39;)
</pre></div>
</div>
<p>使用Docker一段时间后，系统中可能会遗留一些临时的镜像文件，以及一些没有被使用的镜像，可以通过docker
image prune命令来进行清理。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>支持选项包括：

·-a，-all：删除所有无用镜像，不光是临时镜像；

·-filter filter：只清理符合给定过滤器的镜像；

·-f，-force：强制删除镜像，而不进行提示确认。
</pre></div>
</div>
<p>例如，如下命令会自动清理临时的遗留镜像文件层，最后会提示释放的存储空间：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker image prune -f
...
Total reclaimed space: 1.4 GB
</pre></div>
</div>
</div>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id22">创建本地镜像</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<div class="section" id="commit">
<h3><a class="toc-backref" href="#id23">使用commit命令创建本地镜像</a><a class="headerlink" href="#commit" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@hujianli</span><span class="o">-</span><span class="n">docker01</span> <span class="n">centos</span><span class="p">]</span><span class="c1"># docker run -it ubuntu</span>

<span class="n">root</span><span class="nd">@d78a1c4c8541</span><span class="p">:</span><span class="o">/</span><span class="c1"># apt-get update</span>

<span class="c1">#安装sqlite3</span>
<span class="n">root</span><span class="nd">@d78a1c4c8541</span><span class="p">:</span><span class="o">/</span><span class="c1"># apt-get install sqlite3</span>
<span class="n">root</span><span class="nd">@d78a1c4c8541</span><span class="p">:</span><span class="o">/</span><span class="c1"># echo &quot;test docker commit&quot; &gt;&gt; hellodocker</span>
<span class="n">root</span><span class="nd">@d78a1c4c8541</span><span class="p">:</span><span class="o">/</span><span class="c1"># cat hellodocker</span>
<span class="n">test</span> <span class="n">docker</span> <span class="n">commit</span>
<span class="n">root</span><span class="nd">@d78a1c4c8541</span><span class="p">:</span><span class="o">/</span><span class="c1"># exit</span>
<span class="n">exit</span>

<span class="c1">#记住上面退出时候的容器id：d78a1c4c8541</span>

<span class="c1"># 使用 commit 命令将容器里的所有修改提交到本地库中，形成一个全新的镜像</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@hujianli</span><span class="o">-</span><span class="n">docker01</span> <span class="n">centos</span><span class="p">]</span><span class="c1"># docker commit -m=&quot;Message&quot; --author=&quot;hujianli&quot; d78a1c4c8541 hjl_ubuntu/sqlite3:v1</span>
<span class="n">sha256</span><span class="p">:</span><span class="mi">3</span><span class="n">b450d854758de25b3b90fe30692d55bce75a318136ea7ec48dddbe38fc059a1</span>


<span class="p">[</span><span class="n">root</span><span class="nd">@hujianli</span><span class="o">-</span><span class="n">docker01</span> <span class="n">centos</span><span class="p">]</span><span class="c1"># docker images</span>
<span class="n">REPOSITORY</span>               <span class="n">TAG</span>                 <span class="n">IMAGE</span> <span class="n">ID</span>            <span class="n">CREATED</span>             <span class="n">SIZE</span>
<span class="n">hjl_ubuntu</span><span class="o">/</span><span class="n">sqlite3</span>       <span class="n">v1</span>                  <span class="mi">3</span><span class="n">b450d854758</span>        <span class="mi">54</span> <span class="n">seconds</span> <span class="n">ago</span>      <span class="mf">95.6</span><span class="n">MB</span>
<span class="n">ubuntu</span>                   <span class="n">latest</span>              <span class="mi">4</span><span class="n">c108a37151f</span>        <span class="mi">2</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mf">64.2</span><span class="n">MB</span>
<span class="n">portworx</span><span class="o">/</span><span class="n">px</span><span class="o">-</span><span class="n">enterprise</span>   <span class="mf">2.0</span><span class="o">.</span><span class="mf">3.7</span>             <span class="n">a63b970ac332</span>        <span class="mi">2</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mf">2.51</span><span class="n">GB</span>
<span class="n">quay</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">coreos</span><span class="o">/</span><span class="n">etcd</span>      <span class="n">latest</span>              <span class="mi">61</span><span class="n">ad63875109</span>        <span class="mi">12</span> <span class="n">months</span> <span class="n">ago</span>       <span class="mf">39.5</span><span class="n">MB</span>

<span class="c1"># 我们使用刚才创建的镜像来构建一个容器并运行，以检视所做的修改</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@hujianli</span><span class="o">-</span><span class="n">docker01</span> <span class="n">centos</span><span class="p">]</span><span class="c1"># docker run -it hjl_ubuntu/sqlite3:v1</span>
<span class="n">root</span><span class="nd">@aa51b9edac11</span><span class="p">:</span><span class="o">/</span><span class="c1"># cat hellodocker</span>
<span class="n">test</span> <span class="n">docker</span> <span class="n">commit</span>

<span class="n">root</span><span class="nd">@aa51b9edac11</span><span class="p">:</span><span class="o">/</span><span class="c1"># sqlite3 -version</span>
<span class="mf">3.22</span><span class="o">.</span><span class="mi">0</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">18</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">57</span> <span class="mi">0</span><span class="n">c55d179733b46d8d0ba4d88e01a25e10677046ee3da1d5b1581e86726f2alt1</span>
</pre></div>
</div>
</div>
<div class="section" id="dockerfile">
<h3><a class="toc-backref" href="#id24">使用 Dockerfile 创建镜像</a><a class="headerlink" href="#dockerfile" title="Permalink to this headline">¶</a></h3>
<p>基于Dockerfile创建是最常见的方式。Dockerfile是一个文本文件，利用给定的指令描述基于某个父镜像创建新镜像的过程。</p>
<p>下面给出Dockerfile的一个简单示例，基于debian：stretch-slim镜像安装Python
3环境，构成一个新的python：3镜像：</p>
<p><code class="docutils literal"><span class="pre">Dockerfile</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">debian</span><span class="p">:</span><span class="n">stretch</span><span class="o">-</span><span class="n">slim</span>
<span class="n">LABEL</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">maintainer</span><span class="o">=</span><span class="s2">&quot;docker user &lt;docker_user@github&gt;&quot;</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> \
    <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span> <span class="o">&amp;&amp;</span> \
    <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">clean</span> <span class="o">&amp;&amp;</span> \
    <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">lists</span><span class="o">/*</span>
</pre></div>
</div>
<p>创建镜像的过程可以使用docker[image]build命令，编译成功后本地将多出一个python:3镜像：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker [image] build -t python:3 .
...
Successfully built 4b10f46eacc8
Successfully tagged python:3
$ docker images|grep python
python 3 4b10f46eacc8 About a minute ago   95.1MB
</pre></div>
</div>
<p>推荐使用Dockerfile来构建镜像。将需要对镜像进行的操作全部
写到一个文件中，然后使用 docker build
命令从这个文件中创建镜像。这种方法可以使镜像的创
建变得透明和独立化，并且创建过程可以被重复执行。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Version: 1.0.1</span>
<span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="n">latest</span>
<span class="n">MAINTAINER</span> <span class="n">xxh</span> <span class="s2">&quot;xxh@qq.com&quot;</span>
<span class="c1">#设置root用户为后续命令的执行者</span>
<span class="n">USER</span> <span class="n">root</span>

<span class="c1">#执行操作</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">nginx</span>

<span class="c1">#使用&amp;&amp;拼接命令</span>
<span class="n">RUN</span> <span class="n">touch</span> <span class="n">test</span><span class="o">.</span><span class="n">txt</span> <span class="o">&amp;&amp;</span> <span class="n">echo</span> <span class="s2">&quot;abc&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">abc</span><span class="o">.</span><span class="n">txt</span>

<span class="c1">#对外暴露端口</span>
<span class="n">EXPOSE</span> <span class="mi">80</span> <span class="mi">8080</span> <span class="mi">1038</span>

<span class="c1">#添加文件</span>
<span class="n">ADD</span> <span class="n">abc</span><span class="o">.</span><span class="n">txt</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span>

<span class="c1">#添加文件夹</span>
<span class="n">ADD</span> <span class="o">/</span><span class="n">webapp</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">webapp</span>

<span class="c1">#添加网络文件</span>
<span class="n">ADD</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">baidu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">img</span><span class="o">/</span><span class="n">bd_logo1</span><span class="o">.</span><span class="n">png</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span>


<span class="c1">#设置环境变量</span>
<span class="n">ENV</span> <span class="n">WEBAPP_PORT</span><span class="o">=</span><span class="mi">9090</span>

<span class="c1">#设置工作目录</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span>

<span class="c1">#设置启动命令</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">]</span>

<span class="c1">#设置启动参数</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="s2">&quot;-l&quot;</span> <span class="p">]</span>

<span class="c1">#设置卷</span>
<span class="n">VOLUME</span> <span class="p">[</span><span class="s2">&quot;/data&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/www&quot;</span><span class="p">]</span>

<span class="c1">#设置子镜像的触发操作</span>
<span class="n">ONBUILD</span> <span class="n">ADD</span> <span class="o">.</span> <span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">src</span>
<span class="n">ONBUILD</span> <span class="n">RUN</span> <span class="n">echo</span> <span class="s2">&quot;on build excuted&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">onbuild</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">-t</span> <span class="pre">xixihe/test:v1</span> <span class="pre">.</span></code></p>
<p>其中 -t 参数用来指定镜像的命名空间、仓库名及 TAG
。这个值可以在镜像创建成功之后通过 tag 命
令修改，事实上是创建一个镜像的两个名称引用，如下所示的 xixihe/test:v1 和
xixihe/test:v2指向的是同一个镜像实体 8758374dc545 ：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">tag</span> <span class="n">xixihe</span><span class="o">/</span><span class="n">test</span><span class="p">:</span><span class="n">v1</span> <span class="n">xixihe</span><span class="o">/</span><span class="n">test</span><span class="p">:</span><span class="n">v2</span>

<span class="c1"># docker images</span>
<span class="n">REPOSITORY</span> <span class="n">TAG</span> <span class="n">IMAGE</span> <span class="n">ID</span> <span class="n">CREATED</span> <span class="n">VIRTUAL</span> <span class="n">SIZE</span>
<span class="n">xixihe</span><span class="o">/</span><span class="n">test</span> <span class="n">v2</span> <span class="mi">8758374</span><span class="n">dc545</span> <span class="mi">5</span> <span class="n">minutes</span> <span class="n">ago</span> <span class="mf">192.7</span> <span class="n">MB</span>
<span class="n">xixihe</span><span class="o">/</span><span class="n">test</span> <span class="n">v1</span> <span class="mi">8758374</span><span class="n">dc545</span> <span class="mi">5</span> <span class="n">minutes</span> <span class="n">ago</span> <span class="mf">192.7</span> <span class="n">MB</span>
<span class="n">ubuntu</span> <span class="n">latest</span> <span class="mi">9</span><span class="n">bd07e480c5b</span> <span class="mi">6</span> <span class="n">days</span> <span class="n">ago</span> <span class="mf">192.7</span> <span class="n">MB</span>
</pre></div>
</div>
<p>后面会在Docker经典示例中详细介绍。这里就不细解剖知识点了。</p>
</div>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id25">基于本地模板导入</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#下载了ubuntu-14.04的模板压缩包，之后使用以下命令导入：</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2ze38chylj63vuj6fqiaZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat ubuntu-14.04-x86_64-minimal.tar.gz | docker import - ubuntu:14.04</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id26">存出和载入镜像</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">##存出镜像</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2ze38chylj63vuj6fqiaZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker save -o ubuntu_14.04.tar ubuntu:14.04</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2ze38chylj63vuj6fqiaZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ll</span>
<span class="n">total</span> <span class="mi">192732</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">197355520</span> <span class="n">May</span> <span class="mi">29</span> <span class="mi">17</span><span class="p">:</span><span class="mi">53</span> <span class="n">ubuntu_14</span><span class="o">.</span><span class="mf">04.</span><span class="n">tar</span>
<span class="c1">#用户就可以通过复制ubuntu_14.04.tar文件将该镜像分享给他人使用了</span>



<span class="c1">##载入镜像</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2ze38chylj63vuj6fqiaZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker images</span>
<span class="n">REPOSITORY</span>          <span class="n">TAG</span>                 <span class="n">IMAGE</span> <span class="n">ID</span>            <span class="n">CREATED</span>             <span class="n">SIZE</span>

<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2ze38chylj63vuj6fqiaZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker load --input ubuntu_14.04.tar</span>
<span class="n">b057ab380990</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">layer</span> <span class="p">[</span><span class="o">==================================================&gt;</span><span class="p">]</span> <span class="mf">197.1</span> <span class="n">MB</span><span class="o">/</span><span class="mf">197.1</span> <span class="n">MB</span>
<span class="mi">46</span><span class="n">c1a22ffea5</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">layer</span> <span class="p">[</span><span class="o">==================================================&gt;</span><span class="p">]</span> <span class="mf">209.9</span> <span class="n">kB</span><span class="o">/</span><span class="mf">209.9</span> <span class="n">kB</span>
<span class="mi">48334332</span><span class="n">ed8d</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">layer</span> <span class="p">[</span><span class="o">==================================================&gt;</span><span class="p">]</span> <span class="mf">7.168</span> <span class="n">kB</span><span class="o">/</span><span class="mf">7.168</span> <span class="n">kB</span>
<span class="mi">66285</span><span class="n">ac4bf24</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">layer</span> <span class="p">[</span><span class="o">==================================================&gt;</span><span class="p">]</span> <span class="mf">3.072</span> <span class="n">kB</span><span class="o">/</span><span class="mf">3.072</span> <span class="n">kB</span>
<span class="n">Loaded</span> <span class="n">image</span><span class="p">:</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">14.04</span>

<span class="c1">#或者</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2ze38chylj63vuj6fqiaZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker load &lt; ubuntu_14.04.tar</span>
<span class="n">b057ab380990</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">layer</span> <span class="p">[</span><span class="o">==================================================&gt;</span><span class="p">]</span> <span class="mf">197.1</span> <span class="n">MB</span><span class="o">/</span><span class="mf">197.1</span> <span class="n">MB</span>
<span class="mi">46</span><span class="n">c1a22ffea5</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">layer</span> <span class="p">[</span><span class="o">==================================================&gt;</span><span class="p">]</span> <span class="mf">209.9</span> <span class="n">kB</span><span class="o">/</span><span class="mf">209.9</span> <span class="n">kB</span>
<span class="mi">48334332</span><span class="n">ed8d</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">layer</span> <span class="p">[</span><span class="o">==================================================&gt;</span><span class="p">]</span> <span class="mf">7.168</span> <span class="n">kB</span><span class="o">/</span><span class="mf">7.168</span> <span class="n">kB</span>
<span class="mi">66285</span><span class="n">ac4bf24</span><span class="p">:</span> <span class="n">Loading</span> <span class="n">layer</span> <span class="p">[</span><span class="o">==================================================&gt;</span><span class="p">]</span> <span class="mf">3.072</span> <span class="n">kB</span><span class="o">/</span><span class="mf">3.072</span> <span class="n">kB</span>
<span class="n">Loaded</span> <span class="n">image</span><span class="p">:</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">14.04</span>
</pre></div>
</div>
</div>
<div class="section" id="docker-hub">
<h2><a class="toc-backref" href="#id27">Docker Hub</a><a class="headerlink" href="#docker-hub" title="Permalink to this headline">¶</a></h2>
<p>Docker
Hub的网址是https://hub.docker.com，它与提供源代码托管服务的GitHub类似，</p>
<p>不同的是Docker Hub提供的是镜像托管服务。利用Docker
Hub，我们可以搜索、创建、分享和管理镜像，
还可以利用其提供的自动化构建技术直接在集群云服务器上构建镜像</p>
<p>Docker Hub上的镜像分为两类。一类是官方镜像，比如 ubuntu 、 nginx 、
redis 、 mysql 、 wordpress
等，此类镜像一般由权威的第三方（比如Canonical、Oracle、Red
Hat等极具背景的大公司）进行
开发维护，最后还需要Docker官方认证通过。另一类为普通用户镜像。</p>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id28">镜像的分发</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>#登录Docker Hub账号
docker login

登录信息都保存在/root/.docker/config.json文件中：
[root@hujianli-docker01 centos]# cat ~/.docker/config.json
{
    &quot;auths&quot;: {
        &quot;https://index.docker.io/v1/&quot;: {
            &quot;auth&quot;: &quot;MTg3OTMyNDc2NDphZG1pbiMxMjM=&quot;
        }
    },
    &quot;HttpHeaders&quot;: {
        &quot;User-Agent&quot;: &quot;Docker-Client/18.09.7 (linux)&quot;
    }
</pre></div>
</div>
<p>登录成功之后，使用 push 命令上传镜像。如果不指定镜像 TAG
，指定的仓库在本地的所有镜像都会上传到Docker Hub。</p>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id29">上传镜像</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#可以使用docker push命令上传镜像到仓库，默认上传到Docker Hub官方仓库</span>
<span class="n">docker</span> <span class="n">push</span> <span class="n">NAME</span><span class="p">[:</span><span class="n">TAG</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="n">REGISTRY_HOST</span><span class="p">[:</span><span class="n">REGISTRY_PORT</span><span class="p">]</span><span class="o">/</span><span class="p">]</span><span class="n">NAME</span><span class="p">[:</span><span class="n">TAG</span><span class="p">]</span>

<span class="n">sudo</span> <span class="n">docker</span> <span class="n">login</span>
<span class="c1">#先得添加新的标签</span>
<span class="n">docker</span> <span class="n">tag</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">14.04</span> <span class="mi">1879324764</span><span class="o">/</span><span class="n">ubuntu_test</span><span class="p">:</span><span class="mf">14.04</span>
<span class="c1">#然后将新添加标签的image上传到DockerHub上</span>
<span class="n">docker</span> <span class="n">push</span> <span class="mi">1879324764</span><span class="o">/</span><span class="n">ubuntu_test</span><span class="p">:</span><span class="mf">14.04</span>
</pre></div>
</div>
<p>举例说明</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#查看镜像
[root@pxe-server ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hu_tomcat_001       latest              fb758b420be9        4 weeks ago         1.49GB
mariadb             latest              1813edbc6da2        4 weeks ago         1GB


# 镜像改名，改为 DockerHubaccount/镜像名:版本Tag
[root@pxe-server ~]# docker tag mariadb:latest 1879324764/mariadb:latest


[root@pxe-server ~]# docker images
REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE
hu_tomcat_001        latest              fb758b420be9        4 weeks ago         1.49GB
1879324764/mariadb   latest              1813edbc6da2        4 weeks ago         1GB
mariadb              latest              1813edbc6da2        4 weeks ago         1GB

# 登录DcokerHub，使用DockerHubaccount和密码
[root@pxe-server ~]# docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don&#39;t have a Docker ID, head over to https://hub.docker.com to create
one.Username: 1879324764
Password:
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded

# 推送镜像到DockerHub上
[root@pxe-server ~]# docker push 1879324764/mariadb
</pre></div>
</div>
<p>第一次上传时，会提示输入登录信息或进行注册，之后登录信息会记录到本地~/.docker目录下。</p>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id30">搭建自己的私有仓库</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>除了使用Docker官方提供的注册服务器Docker
Hub来存储管理镜像之外，我们还可以搭建自 己的注册服务器。Docker
Hub所使用的注册服务器本身是开源的，并且以镜像的形式分发在 Docker Hub上。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>注册服务器源码的地址是https://github.com/docker/docker-registry，
Docker Hub上的镜像名是 registry
</pre></div>
</div>
<p>我们只需要两步,就能完成注册服务器的创建</p>
<p>①拉取最新的registry官方镜像：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># docker pull registry</span>
</pre></div>
</div>
<p>②运行registry：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># docker run -p 5000:5000 -d -i -t registry</span>
</pre></div>
</div>
<p>这样我们的注册服务器就已经成功地在5000端口运行了。接下来，可以将我们的镜像提交到,这个注册服务器上。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>我们使用 commit 命令将任意一个容器提交成镜像，
并且按照[registry_host: registry_port\image_name:image_tag]方式指定TAG：
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span># docker ps -a
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS
NAMES
...
56d26c54b98f    registry:latest &quot;docker-registry&quot; 9 minutes ago Exited (3) 9 minutes ago
pensive_davinci
...


# docker commit 56d26c54b98f 127.0.0.1:5000/my_image:v1
e35c26122c2ada4f2fb1a84542c3a0ec9e1e0dc191949e01cf5ba43da6aef410


接下来，提交这个镜像到注册服务器：
# docker push 127.0.0.1:5000/my_image:v1
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="03.操作Docker容器.html" class="btn btn-neutral float-right" title="操作Docker容器" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="01.初识Docker与容器.html" class="btn btn-neutral float-left" title="初识Docker与容器" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, huxiaojian

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>